-- =================================================================================
-- الحزمة: PKG_SECURITY_CONTEXT
-- الوصف: إدارة معلومات المستخدم في الـ Session (Specification)
-- الهدف: توفير آلية آمنة لتخزين واسترجاع معلومات المستخدم الحالي
-- =================================================================================

CREATE OR REPLACE PACKAGE PKG_SECURITY_CONTEXT AS

    -- ==========================================================
    -- الثوابت
    -- ==========================================================
    C_CONTEXT_NAMESPACE CONSTANT VARCHAR2(30) := 'HRMS_USER_CTX';
    C_DEFAULT_USER CONSTANT VARCHAR2(50) := 'SYSTEM';

    -- ==========================================================
    -- إجراء: تعيين معلومات المستخدم في الـ Session
    -- ==========================================================
    -- الوصف: يتم استدعاؤه من الـ API في بداية كل request
    -- المعاملات:
    --   p_username: اسم المستخدم (مطلوب)
    --   p_user_id: معرف المستخدم (اختياري)
    --   p_branch_id: معرف الفرع (اختياري)
    --   p_dept_id: معرف القسم (اختياري)
    -- ==========================================================
    PROCEDURE SET_USER_INFO (
        p_username      IN VARCHAR2,
        p_user_id       IN NUMBER DEFAULT NULL,
        p_branch_id     IN NUMBER DEFAULT NULL,
        p_dept_id       IN NUMBER DEFAULT NULL
    );

    -- ==========================================================
    -- دالة: الحصول على اسم المستخدم الحالي
    -- ==========================================================
    -- الإرجاع: اسم المستخدم أو 'SYSTEM' إذا لم يتم تعيينه
    -- ==========================================================
    FUNCTION GET_CURRENT_USER RETURN VARCHAR2;

    -- ==========================================================
    -- دالة: الحصول على معرف المستخدم الحالي
    -- ==========================================================
    -- الإرجاع: معرف المستخدم أو NULL إذا لم يتم تعيينه
    -- ==========================================================
    FUNCTION GET_CURRENT_USER_ID RETURN NUMBER;

    -- ==========================================================
    -- دالة: الحصول على معرف الفرع الحالي
    -- ==========================================================
    FUNCTION GET_CURRENT_BRANCH_ID RETURN NUMBER;

    -- ==========================================================
    -- دالة: الحصول على معرف القسم الحالي
    -- ==========================================================
    FUNCTION GET_CURRENT_DEPT_ID RETURN NUMBER;

    -- ==========================================================
    -- إجراء: مسح معلومات المستخدم من الـ Session
    -- ==========================================================
    -- الوصف: يتم استدعاؤه في نهاية الـ request أو عند Logout
    -- ==========================================================
    PROCEDURE CLEAR_CONTEXT;

    -- ==========================================================
    -- دالة: التحقق من وجود context نشط
    -- ==========================================================
    -- الإرجاع: 1 إذا كان هناك context نشط، 0 إذا لم يكن
    -- ==========================================================
    FUNCTION IS_CONTEXT_SET RETURN NUMBER;

    -- ==========================================================
    -- دالة: الحصول على معلومات كاملة عن الـ Session
    -- ==========================================================
    -- الإرجاع: JSON string يحتوي على كل معلومات الـ context
    -- ==========================================================
    FUNCTION GET_SESSION_INFO RETURN VARCHAR2;

END PKG_SECURITY_CONTEXT;
/
