-- =================================================================================
-- المخطط: HR_CORE
-- الوصف: الإعدادات الأساسية، الهيكل التنظيمي، والقوائم المنسدلة
-- =================================================================================

-- الدول
CREATE TABLE HR_CORE.COUNTRIES (
    COUNTRY_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    COUNTRY_NAME_AR VARCHAR2(100) NOT NULL,
    COUNTRY_NAME_EN VARCHAR2(100) NOT NULL,
    CITIZENSHIP_NAME_AR VARCHAR2(100),
    ISO_CODE CHAR(2) UNIQUE,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- المدن
CREATE TABLE HR_CORE.CITIES (
    CITY_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    COUNTRY_ID NUMBER(3) NOT NULL,
    CITY_NAME_AR VARCHAR2(100) NOT NULL,
    CITY_NAME_EN VARCHAR2(100) NOT NULL,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_CITY_COUNTRY FOREIGN KEY (COUNTRY_ID) REFERENCES HR_CORE.COUNTRIES(COUNTRY_ID)
);

-- الفروع
CREATE TABLE HR_CORE.BRANCHES (
    BRANCH_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    BRANCH_NAME_AR VARCHAR2(100) NOT NULL,
    BRANCH_NAME_EN VARCHAR2(100),
    CITY_ID NUMBER(5),
    ADDRESS VARCHAR2(200),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_BRANCH_CITY FOREIGN KEY (CITY_ID) REFERENCES HR_CORE.CITIES(CITY_ID)
);

-- الأقسام
CREATE TABLE HR_CORE.DEPARTMENTS (
    DEPT_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DEPT_NAME_AR VARCHAR2(100) NOT NULL,
    DEPT_NAME_EN VARCHAR2(100),
    PARENT_DEPT_ID NUMBER(5),
    BRANCH_ID NUMBER(3) NOT NULL,
    COST_CENTER_CODE VARCHAR2(50),
    MANAGER_ID NUMBER,
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_DEPT_PARENT FOREIGN KEY (PARENT_DEPT_ID) REFERENCES HR_CORE.DEPARTMENTS(DEPT_ID),
    CONSTRAINT FK_DEPT_BRANCH FOREIGN KEY (BRANCH_ID) REFERENCES HR_CORE.BRANCHES(BRANCH_ID)
);

-- الدرجات الوظيفية
CREATE TABLE HR_CORE.JOB_GRADES (
    GRADE_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    GRADE_NAME VARCHAR2(50) NOT NULL,
    MIN_SALARY NUMBER(10, 2),
    MAX_SALARY NUMBER(10, 2),
    TICKET_CLASS VARCHAR2(20),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- المسميات الوظيفية
CREATE TABLE HR_CORE.JOBS (
    JOB_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    JOB_TITLE_AR VARCHAR2(100) NOT NULL,
    JOB_TITLE_EN VARCHAR2(100),
    DEFAULT_GRADE_ID NUMBER(3),
    IS_MEDICAL NUMBER(1) DEFAULT 0,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_JOB_GRADE FOREIGN KEY (DEFAULT_GRADE_ID) REFERENCES HR_CORE.JOB_GRADES(GRADE_ID)
);

-- أنواع الوثائق
CREATE TABLE HR_CORE.DOCUMENT_TYPES (
    DOC_TYPE_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DOC_NAME_AR VARCHAR2(100) NOT NULL,
    IS_MANDATORY NUMBER(1) DEFAULT 0,
    REQUIRES_EXPIRY NUMBER(1) DEFAULT 1,
    ALERT_DAYS_BEFORE NUMBER(3) DEFAULT 30,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- البنوك
CREATE TABLE HR_CORE.BANKS (
    BANK_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    BANK_NAME_AR VARCHAR2(100) NOT NULL,
    BANK_NAME_EN VARCHAR2(100),
    BANK_CODE VARCHAR2(20),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- ملاحظة: الصلاحيات (GRANT) سيتم منحها في ملف منفصل بعد إنشاء جميع الجداول
-- =================================================================================
-- المخطط: HR_PERSONNEL
-- الوصف: الموظفين، العقود، والمعلومات الشخصية
-- =================================================================================

-- جدول الموظفين الرئيسي
CREATE TABLE HR_PERSONNEL.EMPLOYEES (
    EMPLOYEE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_NUMBER VARCHAR2(20) NOT NULL UNIQUE,
    FIRST_NAME_AR VARCHAR2(50) NOT NULL,
    SECOND_NAME_AR VARCHAR2(50),
    THIRD_NAME_AR VARCHAR2(50),
    HIJRI_LAST_NAME_AR VARCHAR2(50) NOT NULL,
    FULL_NAME_EN VARCHAR2(200) NOT NULL,
    
    GENDER CHAR(1) CHECK (GENDER IN ('M', 'F')),
    BIRTH_DATE DATE NOT NULL,
    MARITAL_STATUS VARCHAR2(20) CHECK (MARITAL_STATUS IN ('SINGLE', 'MARRIED', 'DIVORCED', 'WIDOWED')),
    
    NATIONALITY_ID NUMBER(3) NOT NULL,
    JOB_ID NUMBER(5) NOT NULL,
    DEPT_ID NUMBER(5) NOT NULL,
    MANAGER_ID NUMBER(10),
    
    JOINING_DATE DATE NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'ACTIVE' CHECK (STATUS IN ('ACTIVE', 'ON_LEAVE', 'TERMINATED', 'RESIGNED')),
    EMAIL VARCHAR2(100),
    MOBILE VARCHAR2(20),
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_EMP_NATIONALITY FOREIGN KEY (NATIONALITY_ID) REFERENCES HR_CORE.COUNTRIES(COUNTRY_ID),
    CONSTRAINT FK_EMP_JOB FOREIGN KEY (JOB_ID) REFERENCES HR_CORE.JOBS(JOB_ID),
    CONSTRAINT FK_EMP_DEPT FOREIGN KEY (DEPT_ID) REFERENCES HR_CORE.DEPARTMENTS(DEPT_ID),
    CONSTRAINT FK_EMP_MANAGER FOREIGN KEY (MANAGER_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- وثائق الموظف
CREATE TABLE HR_PERSONNEL.EMPLOYEE_DOCUMENTS (
    DOC_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    DOC_TYPE_ID NUMBER(3) NOT NULL,
    DOC_NUMBER VARCHAR2(50),
    ISSUE_DATE DATE,
    EXPIRY_DATE DATE,
    ISSUE_PLACE VARCHAR2(100),
    ATTACHMENT_PATH VARCHAR2(500),
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_DOC_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_DOC_TYPE FOREIGN KEY (DOC_TYPE_ID) REFERENCES HR_CORE.DOCUMENT_TYPES(DOC_TYPE_ID)
);

-- العقود
CREATE TABLE HR_PERSONNEL.CONTRACTS (
    CONTRACT_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    CONTRACT_TYPE VARCHAR2(50) CHECK (CONTRACT_TYPE IN ('FULL_TIME', 'PART_TIME', 'LOCUM', 'VISITING')),
    START_DATE DATE NOT NULL,
    END_DATE DATE,
    IS_RENEWABLE NUMBER(1) DEFAULT 1,
    
    BASIC_SALARY NUMBER(10, 2) NOT NULL,
    HOUSING_ALLOWANCE NUMBER(10, 2) DEFAULT 0,
    TRANSPORT_ALLOWANCE NUMBER(10, 2) DEFAULT 0,
    OTHER_ALLOWANCES NUMBER(10, 2) DEFAULT 0,
    
    VACATION_DAYS NUMBER(3) DEFAULT 30,
    WORKING_HOURS_DAILY NUMBER(2) DEFAULT 8,
    
    CONTRACT_STATUS VARCHAR2(20) DEFAULT 'ACTIVE' CHECK (CONTRACT_STATUS IN ('ACTIVE', 'EXPIRED', 'TERMINATED')),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_CONT_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- تجديد العقود
CREATE TABLE HR_PERSONNEL.CONTRACT_RENEWALS (
    RENEWAL_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CONTRACT_ID NUMBER(10) NOT NULL,
    OLD_END_DATE DATE NOT NULL,
    NEW_START_DATE DATE NOT NULL,
    NEW_END_DATE DATE NOT NULL,
    RENEWAL_DATE DATE DEFAULT SYSDATE,
    NOTES VARCHAR2(500),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_RENEW_CONT FOREIGN KEY (CONTRACT_ID) REFERENCES HR_PERSONNEL.CONTRACTS(CONTRACT_ID)
);

-- التابعين (المرافقين)
CREATE TABLE HR_PERSONNEL.DEPENDENTS (
    DEPENDENT_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    NAME_AR VARCHAR2(100) NOT NULL,
    RELATIONSHIP VARCHAR2(50) NOT NULL,
    BIRTH_DATE DATE,
    NATIONAL_ID VARCHAR2(20),
    IS_ELIGIBLE_FOR_TICKET NUMBER(1) DEFAULT 1,
    IS_ELIGIBLE_FOR_INSURANCE NUMBER(1) DEFAULT 1,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_DEP_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- المؤهلات العلمية
CREATE TABLE HR_PERSONNEL.EMPLOYEE_QUALIFICATIONS (
    QUALIFICATION_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    DEGREE_TYPE VARCHAR2(50) NOT NULL, -- بكالوريوس، ماجستير، دكتوراه، دبلوم
    MAJOR_AR VARCHAR2(100) NOT NULL, -- التخصص
    UNIVERSITY_AR VARCHAR2(200),
    COUNTRY_ID NUMBER(3),
    GRADUATION_YEAR NUMBER(4),
    GRADE VARCHAR2(20), -- ممتاز، جيد جداً
    ATTACHMENT_PATH VARCHAR2(500),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_QUAL_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_QUAL_COUNTRY FOREIGN KEY (COUNTRY_ID) REFERENCES HR_CORE.COUNTRIES(COUNTRY_ID)
);

-- الخبرات السابقة
CREATE TABLE HR_PERSONNEL.EMPLOYEE_EXPERIENCES (
    EXPERIENCE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    COMPANY_NAME_AR VARCHAR2(200) NOT NULL,
    JOB_TITLE_AR VARCHAR2(100),
    START_DATE DATE NOT NULL,
    END_DATE DATE,
    IS_CURRENT NUMBER(1) DEFAULT 0,
    RESPONSIBILITIES VARCHAR2(500),
    REASON_FOR_LEAVING VARCHAR2(200),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_EXP_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- الشهادات المهنية والتراخيص (مهم جداً للأطباء)
CREATE TABLE HR_PERSONNEL.EMPLOYEE_CERTIFICATIONS (
    CERT_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    CERT_NAME_AR VARCHAR2(200) NOT NULL, -- BLS, ACLS, رخصة هيئة التخصصات
    ISSUING_AUTHORITY VARCHAR2(200), -- الجهة المانحة
    ISSUE_DATE DATE,
    EXPIRY_DATE DATE,
    CERT_NUMBER VARCHAR2(100),
    IS_MANDATORY NUMBER(1) DEFAULT 0, -- إلزامية لمزاولة المهنة
    ATTACHMENT_PATH VARCHAR2(500),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_CERT_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- العناوين (الحالي، الدائم)
CREATE TABLE HR_PERSONNEL.EMPLOYEE_ADDRESSES (
    ADDRESS_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    ADDRESS_TYPE VARCHAR2(20) CHECK (ADDRESS_TYPE IN ('CURRENT', 'PERMANENT', 'EMERGENCY')),
    CITY_ID NUMBER(5),
    DISTRICT VARCHAR2(100), -- الحي
    STREET VARCHAR2(200),
    BUILDING_NO VARCHAR2(20),
    POSTAL_CODE VARCHAR2(20),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_ADDR_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_ADDR_CITY FOREIGN KEY (CITY_ID) REFERENCES HR_CORE.CITIES(CITY_ID)
);

-- جهات الاتصال للطوارئ
CREATE TABLE HR_PERSONNEL.EMERGENCY_CONTACTS (
    CONTACT_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    CONTACT_NAME_AR VARCHAR2(100) NOT NULL,
    RELATIONSHIP VARCHAR2(50), -- أب، أخ، زوجة
    PHONE_PRIMARY VARCHAR2(20) NOT NULL,
    PHONE_SECONDARY VARCHAR2(20),
    IS_PRIMARY NUMBER(1) DEFAULT 0, -- جهة الاتصال الرئيسية
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_EMERG_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- الحسابات البنكية (قد يكون للموظف أكثر من حساب)
CREATE TABLE HR_PERSONNEL.EMPLOYEE_BANK_ACCOUNTS (
    ACCOUNT_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    BANK_ID NUMBER(3) NOT NULL,
    ACCOUNT_NUMBER VARCHAR2(50) NOT NULL,
    IBAN VARCHAR2(50),
    IS_PRIMARY NUMBER(1) DEFAULT 1, -- الحساب الرئيسي لتحويل الراتب
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_BANK_ACC_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_BANK_ACC_BANK FOREIGN KEY (BANK_ID) REFERENCES HR_CORE.BANKS(BANK_ID)
);

-- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
-- =================================================================================
-- المخطط: HR_ATTENDANCE
-- الوصف: إدارة المناوبات، الجداول، وسجلات الحضور
-- =================================================================================

-- 1. جداول الإعداد
CREATE TABLE HR_ATTENDANCE.SHIFT_TYPES (
    SHIFT_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    SHIFT_NAME_AR VARCHAR2(100) NOT NULL,
    START_TIME CHAR(5) NOT NULL,
    END_TIME CHAR(5) NOT NULL,
    HOURS_COUNT NUMBER(4, 2) NOT NULL,
    IS_CROSS_DAY NUMBER(1) DEFAULT 0,
    GRACE_PERIOD_MINS NUMBER(3) DEFAULT 15,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- فترات الجداول (الروستر)
CREATE TABLE HR_ATTENDANCE.ROSTER_PERIODS (
    PERIOD_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    YEAR NUMBER(4) NOT NULL,
    MONTH NUMBER(2) NOT NULL,
    START_DATE DATE NOT NULL,
    END_DATE DATE NOT NULL,
    IS_LOCKED NUMBER(1) DEFAULT 0,
    LOCKED_BY NUMBER(10),
    NOTES VARCHAR2(200),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- 2. الجدول المخطط
CREATE TABLE HR_ATTENDANCE.EMPLOYEE_ROSTERS (
    ROSTER_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    ROSTER_DATE DATE NOT NULL,
    SHIFT_ID NUMBER(3),
    IS_OFF_DAY NUMBER(1) DEFAULT 0,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_ROSTER_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_ROSTER_SHIFT FOREIGN KEY (SHIFT_ID) REFERENCES HR_ATTENDANCE.SHIFT_TYPES(SHIFT_ID),
    CONSTRAINT UQ_ROSTER_EMP_DATE UNIQUE (EMPLOYEE_ID, ROSTER_DATE)
);

-- 3. الحضور الفعلي
CREATE TABLE HR_ATTENDANCE.RAW_PUNCH_LOGS (
    LOG_ID NUMBER(19) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    DEVICE_ID VARCHAR2(50),
    PUNCH_TIME TIMESTAMP NOT NULL,
    PUNCH_TYPE VARCHAR2(10) CHECK (PUNCH_TYPE IN ('IN', 'OUT', 'BREAK_IN', 'BREAK_OUT')),
    IS_PROCESSED NUMBER(1) DEFAULT 0,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_LOG_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- 4. الحضور اليومي المعالج
CREATE TABLE HR_ATTENDANCE.DAILY_ATTENDANCE (
    RECORD_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    ATTENDANCE_DATE DATE NOT NULL,
    
    PLANNED_SHIFT_ID NUMBER(3),
    ACTUAL_IN_TIME TIMESTAMP,
    ACTUAL_OUT_TIME TIMESTAMP,
    
    LATE_MINUTES NUMBER(4) DEFAULT 0,
    EARLY_LEAVE_MINUTES NUMBER(4) DEFAULT 0,
    OVERTIME_MINUTES NUMBER(4) DEFAULT 0,
    
    STATUS VARCHAR2(20) CHECK (STATUS IN ('PRESENT', 'ABSENT', 'LEAVE', 'HOLIDAY', 'MISSING_PUNCH')),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_DAILY_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_DAILY_SHIFT FOREIGN KEY (PLANNED_SHIFT_ID) REFERENCES HR_ATTENDANCE.SHIFT_TYPES(SHIFT_ID)
);

-- 5. الطلبات
CREATE TABLE HR_ATTENDANCE.SHIFT_SWAP_REQUESTS (
    REQUEST_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    REQUESTER_ID NUMBER(10) NOT NULL,
    TARGET_EMPLOYEE_ID NUMBER(10) NOT NULL,
    ROSTER_DATE DATE NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'APPROVED', 'REJECTED')),
    MANAGER_COMMENT VARCHAR2(200),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_SWAP_REQ FOREIGN KEY (REQUESTER_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_SWAP_TARGET FOREIGN KEY (TARGET_EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- طلبات الساعات الإضافية (مهم للموافقات)
CREATE TABLE HR_ATTENDANCE.OVERTIME_REQUESTS (
    OT_REQUEST_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    REQUEST_DATE DATE DEFAULT SYSDATE,
    WORK_DATE DATE NOT NULL,
    HOURS_REQUESTED NUMBER(4, 2) NOT NULL,
    REASON VARCHAR2(200),
    STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'APPROVED', 'REJECTED')),
    APPROVED_BY NUMBER(10),
    APPROVED_HOURS NUMBER(4, 2), -- قد تختلف عن المطلوبة
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_OT_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_OT_APPROVER FOREIGN KEY (APPROVED_BY) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- سياسات الحضور حسب القسم/الوظيفة
CREATE TABLE HR_ATTENDANCE.ATTENDANCE_POLICIES (
    POLICY_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    POLICY_NAME_AR VARCHAR2(100) NOT NULL,
    DEPT_ID NUMBER(5), -- إذا كان NULL فهي سياسة عامة
    JOB_ID NUMBER(5),
    LATE_GRACE_MINS NUMBER(3) DEFAULT 15, -- السماح بالتأخير
    OVERTIME_MULTIPLIER NUMBER(3, 2) DEFAULT 1.5, -- معامل الإضافي
    WEEKEND_OT_MULTIPLIER NUMBER(3, 2) DEFAULT 2.0,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_POL_DEPT FOREIGN KEY (DEPT_ID) REFERENCES HR_CORE.DEPARTMENTS(DEPT_ID),
    CONSTRAINT FK_POL_JOB FOREIGN KEY (JOB_ID) REFERENCES HR_CORE.JOBS(JOB_ID)
);

-- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
-- =================================================================================
-- المخطط: HR_LEAVES
-- الوصف: إدارة الإجازات، الأرصدة، والعطل الرسمية
-- =================================================================================

-- أنواع الإجازات
CREATE TABLE HR_LEAVES.LEAVE_TYPES (
    LEAVE_TYPE_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    LEAVE_NAME_AR VARCHAR2(100) NOT NULL,
    IS_PAID NUMBER(1) DEFAULT 1,
    MAX_DAYS_PER_YEAR NUMBER(3),
    REQUIRES_ATTACHMENT NUMBER(1) DEFAULT 0,
    IS_CARRY_FORWARD NUMBER(1) DEFAULT 0,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- أرصدة إجازات الموظفين
CREATE TABLE HR_LEAVES.EMPLOYEE_LEAVE_BALANCES (
    BALANCE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    LEAVE_TYPE_ID NUMBER(3) NOT NULL,
    CURRENT_BALANCE NUMBER(5, 2) DEFAULT 0,
    YEAR NUMBER(4) NOT NULL,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_BAL_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_BAL_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID),
    CONSTRAINT UQ_BAL_EMP_TYPE_YEAR UNIQUE (EMPLOYEE_ID, LEAVE_TYPE_ID, YEAR)
);

-- طلبات الإجازة
CREATE TABLE HR_LEAVES.LEAVE_REQUESTS (
    REQUEST_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    LEAVE_TYPE_ID NUMBER(3) NOT NULL,
    START_DATE DATE NOT NULL,
    END_DATE DATE NOT NULL,
    DAYS_COUNT NUMBER(3) NOT NULL,
    REASON VARCHAR2(200),
    ATTACHMENT_PATH VARCHAR2(500),
    
    STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'MANAGER_APPROVED', 'HR_APPROVED', 'REJECTED')),
    REJECTION_REASON VARCHAR2(200),
    
    IS_POSTED_TO_BALANCE NUMBER(1) DEFAULT 0,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_REQ_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_REQ_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID)
);

-- العطل الرسمية
CREATE TABLE HR_LEAVES.PUBLIC_HOLIDAYS (
    HOLIDAY_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    HOLIDAY_NAME_AR VARCHAR2(100) NOT NULL,
    START_DATE DATE NOT NULL,
    END_DATE DATE NOT NULL,
    YEAR NUMBER(4) NOT NULL,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- قواعد استحقاق الإجازات (Accrual Rules)
CREATE TABLE HR_LEAVES.LEAVE_ACCRUAL_RULES (
    RULE_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    LEAVE_TYPE_ID NUMBER(3) NOT NULL,
    ACCRUAL_FREQUENCY VARCHAR2(20) CHECK (ACCRUAL_FREQUENCY IN ('MONTHLY', 'YEARLY', 'JOINING_DATE')),
    DAYS_PER_PERIOD NUMBER(5, 2) NOT NULL, -- مثلاً 2.5 يوم شهرياً
    MAX_ACCUMULATION NUMBER(3), -- الحد الأقصى للتراكم
    IS_PRORATED NUMBER(1) DEFAULT 1, -- هل يُحسب بالتناسب للموظف الجديد؟
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_ACCR_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID)
);

-- صرف الإجازات نقداً (Encashment)
CREATE TABLE HR_LEAVES.LEAVE_ENCASHMENT (
    ENCASH_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    LEAVE_TYPE_ID NUMBER(3) NOT NULL,
    DAYS_ENCASHED NUMBER(5, 2) NOT NULL,
    AMOUNT NUMBER(10, 2) NOT NULL, -- المبلغ المدفوع
    ENCASH_DATE DATE DEFAULT SYSDATE,
    PAYROLL_RUN_ID NUMBER(10), -- ربط بمسير الراتب
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_ENCASH_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_ENCASH_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID)
);

-- سجل حركات الرصيد (Transactions Log)
CREATE TABLE HR_LEAVES.LEAVE_TRANSACTIONS (
    TRANSACTION_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    LEAVE_TYPE_ID NUMBER(3) NOT NULL,
    TRANSACTION_TYPE VARCHAR2(20) CHECK (TRANSACTION_TYPE IN ('ACCRUAL', 'DEDUCTION', 'ADJUSTMENT', 'CARRY_FORWARD')),
    DAYS NUMBER(5, 2) NOT NULL, -- موجب للإضافة، سالب للخصم
    TRANSACTION_DATE DATE DEFAULT SYSDATE,
    REFERENCE_ID NUMBER(10), -- قد يشير لطلب إجازة أو عملية أخرى
    NOTES VARCHAR2(200),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_TRANS_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_TRANS_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID)
);

-- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
-- =================================================================================
-- المخطط: HR_PAYROLL
-- الوصف: الرواتب، البدلات، الخصومات، ومسيرات الرواتب الشهرية
-- =================================================================================

-- عناصر الراتب (بدلات وخصومات)
CREATE TABLE HR_PAYROLL.SALARY_ELEMENTS (
    ELEMENT_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ELEMENT_NAME_AR VARCHAR2(100) NOT NULL,
    ELEMENT_TYPE VARCHAR2(10) CHECK (ELEMENT_TYPE IN ('EARNING', 'DEDUCTION')),
    IS_TAXABLE NUMBER(1) DEFAULT 0,
    IS_GOSI_BASE NUMBER(1) DEFAULT 0,
    DEFAULT_PERCENTAGE NUMBER(5, 2),
    IS_RECURRING NUMBER(1) DEFAULT 1,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- هيكل راتب الموظف
CREATE TABLE HR_PAYROLL.EMPLOYEE_SALARY_STRUCTURE (
    STRUCTURE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    ELEMENT_ID NUMBER(3) NOT NULL,
    AMOUNT NUMBER(10, 2) DEFAULT 0,
    PERCENTAGE NUMBER(5, 2) DEFAULT 0,
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_STRUCT_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_STRUCT_ELEM FOREIGN KEY (ELEMENT_ID) REFERENCES HR_PAYROLL.SALARY_ELEMENTS(ELEMENT_ID)
);

-- السلف والقروض
CREATE TABLE HR_PAYROLL.LOANS (
    LOAN_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    LOAN_AMOUNT NUMBER(10, 2) NOT NULL,
    REQUEST_DATE DATE DEFAULT SYSDATE,
    INSTALLMENT_COUNT NUMBER(3) NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'ACTIVE' CHECK (STATUS IN ('PENDING', 'ACTIVE', 'CLOSED')),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_LOAN_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- مسيرات الرواتب
CREATE TABLE HR_PAYROLL.PAYROLL_RUNS (
    RUN_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    YEAR NUMBER(4) NOT NULL,
    MONTH NUMBER(2) NOT NULL,
    RUN_DATE DATE DEFAULT SYSDATE,
    STATUS VARCHAR2(20) DEFAULT 'DRAFT' CHECK (STATUS IN ('DRAFT', 'APPROVED', 'PAID')),
    TOTAL_PAYOUT NUMBER(15, 2),
    NOTES VARCHAR2(200),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- قسيمة راتب الموظف
CREATE TABLE HR_PAYROLL.PAYSLIPS (
    PAYSLIP_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    RUN_ID NUMBER(10) NOT NULL,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    BASIC_SALARY NUMBER(10, 2),
    TOTAL_ALLOWANCES NUMBER(10, 2),
    TOTAL_DEDUCTIONS NUMBER(10, 2),
    NET_SALARY NUMBER(10, 2),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_SLIP_RUN FOREIGN KEY (RUN_ID) REFERENCES HR_PAYROLL.PAYROLL_RUNS(RUN_ID),
    CONSTRAINT FK_SLIP_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- تفاصيل قسيمة الراتب
CREATE TABLE HR_PAYROLL.PAYSLIP_DETAILS (
    DETAIL_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    PAYSLIP_ID NUMBER(15) NOT NULL,
    ELEMENT_ID NUMBER(3) NOT NULL,
    ELEMENT_NAME_AR VARCHAR2(100),
    AMOUNT NUMBER(10, 2) NOT NULL,
    TYPE VARCHAR2(10),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_DETAIL_SLIP FOREIGN KEY (PAYSLIP_ID) REFERENCES HR_PAYROLL.PAYSLIPS(PAYSLIP_ID)
);

-- أقساط القروض (Loan Installments)
CREATE TABLE HR_PAYROLL.LOAN_INSTALLMENTS (
    INSTALLMENT_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    LOAN_ID NUMBER(10) NOT NULL,
    INSTALLMENT_NUMBER NUMBER(3) NOT NULL,
    DUE_DATE DATE NOT NULL,
    AMOUNT NUMBER(10, 2) NOT NULL,
    IS_PAID NUMBER(1) DEFAULT 0,
    PAID_IN_PAYROLL_RUN NUMBER(10), -- رقم المسير الذي تم فيه الخصم
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_INST_LOAN FOREIGN KEY (LOAN_ID) REFERENCES HR_PAYROLL.LOANS(LOAN_ID)
);

-- مكافأة نهاية الخدمة (End of Service Benefits)
CREATE TABLE HR_PAYROLL.END_OF_SERVICE_CALC (
    EOS_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    TERMINATION_DATE DATE NOT NULL,
    SERVICE_YEARS NUMBER(5, 2) NOT NULL,
    LAST_BASIC_SALARY NUMBER(10, 2) NOT NULL,
    TOTAL_AMOUNT NUMBER(12, 2) NOT NULL,
    CALCULATION_NOTES VARCHAR2(500), -- شرح الحساب
    IS_PAID NUMBER(1) DEFAULT 0,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_EOS_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- التعديلات اليدوية على الرواتب (Manual Adjustments)
CREATE TABLE HR_PAYROLL.PAYROLL_ADJUSTMENTS (
    ADJUSTMENT_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    PAYROLL_RUN_ID NUMBER(10),
    ADJUSTMENT_TYPE VARCHAR2(20) CHECK (ADJUSTMENT_TYPE IN ('BONUS', 'DEDUCTION', 'CORRECTION')),
    AMOUNT NUMBER(10, 2) NOT NULL,
    REASON VARCHAR2(200) NOT NULL,
    APPROVED_BY NUMBER(10),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT FK_ADJ_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_ADJ_RUN FOREIGN KEY (PAYROLL_RUN_ID) REFERENCES HR_PAYROLL.PAYROLL_RUNS(RUN_ID)
);
-- =================================================================================
-- المخطط: HR_RECRUITMENT
-- الوصف: إدارة التوظيف، الشواغر، والمرشحين
-- التبعيات: يعتمد على HR_CORE, HR_PERSONNEL
-- =================================================================================

-- ALTER SESSION SET CURRENT_SCHEMA = HR_RECRUITMENT;

-- 1. الشواغر الوظيفية
CREATE TABLE HR_RECRUITMENT.JOB_VACANCIES (
    VACANCY_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    JOB_ID NUMBER(5) NOT NULL,
    DEPT_ID NUMBER(5) NOT NULL,
    REQUIRED_COUNT NUMBER(3) DEFAULT 1, -- العدد المطلوب
    JOB_DESCRIPTION CLOB, -- الوصف الوظيفي التفصيلي
    REQUIREMENTS CLOB, -- المتطلبات
    STATUS VARCHAR2(20) DEFAULT 'OPEN' CHECK (STATUS IN ('OPEN', 'CLOSED', 'ON_HOLD', 'CANCELLED')),
    PUBLISH_DATE DATE,
    CLOSING_DATE DATE,
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_VAC_JOB FOREIGN KEY (JOB_ID) REFERENCES HR_CORE.JOBS(JOB_ID),
    CONSTRAINT FK_VAC_DEPT FOREIGN KEY (DEPT_ID) REFERENCES HR_CORE.DEPARTMENTS(DEPT_ID)
);

-- 2. المرشحين (Talent Pool)
CREATE TABLE HR_RECRUITMENT.CANDIDATES (
    CANDIDATE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    FIRST_NAME_AR VARCHAR2(50),
    FAMILY_NAME_AR VARCHAR2(50),
    FULL_NAME_EN VARCHAR2(200) NOT NULL,
    EMAIL VARCHAR2(100) UNIQUE NOT NULL,
    PHONE VARCHAR2(20),
    NATIONALITY_ID NUMBER(3),
    CV_FILE_PATH VARCHAR2(500),
    LINKEDIN_PROFILE VARCHAR2(200),
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_CAND_NAT FOREIGN KEY (NATIONALITY_ID) REFERENCES HR_CORE.COUNTRIES(COUNTRY_ID)
);

-- 3. طلبات التقديم (الربط بين المرشح والشاغر)
CREATE TABLE HR_RECRUITMENT.APPLICATIONS (
    APP_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    VACANCY_ID NUMBER(10) NOT NULL,
    CANDIDATE_ID NUMBER(10) NOT NULL,
    APPLICATION_DATE DATE DEFAULT SYSDATE,
    STATUS VARCHAR2(20) DEFAULT 'APPLIED' CHECK (STATUS IN ('APPLIED', 'SCREENING', 'SHORTLISTED', 'INTERVIEW', 'OFFERED', 'HIRED', 'REJECTED')),
    REJECTION_REASON VARCHAR2(200),
    RX_SOURCE VARCHAR2(50), -- مصدر التوظيف (LinkedIn, Portal, Referral)
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_APP_VAC FOREIGN KEY (VACANCY_ID) REFERENCES HR_RECRUITMENT.JOB_VACANCIES(VACANCY_ID),
    CONSTRAINT FK_APP_CAND FOREIGN KEY (CANDIDATE_ID) REFERENCES HR_RECRUITMENT.CANDIDATES(CANDIDATE_ID)
);

-- 4. المقابلات
CREATE TABLE HR_RECRUITMENT.INTERVIEWS (
    INTERVIEW_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    APP_ID NUMBER(10) NOT NULL,
    INTERVIEWER_ID NUMBER(10), -- الموظف الذي يجري المقابلة
    SCHEDULED_TIME TIMESTAMP NOT NULL,
    INTERVIEW_TYPE VARCHAR2(20) DEFAULT 'IN_PERSON' CHECK (INTERVIEW_TYPE IN ('PHONE', 'ONLINE', 'IN_PERSON')),
    RATING NUMBER(1), -- 1 to 5
    FEEDBACK CLOB,
    RESULT VARCHAR2(20) CHECK (RESULT IN ('PASS', 'FAIL', 'PENDING')),
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_INT_APP FOREIGN KEY (APP_ID) REFERENCES HR_RECRUITMENT.APPLICATIONS(APP_ID),
    CONSTRAINT FK_INT_EMP FOREIGN KEY (INTERVIEWER_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- 5. عروض العمل
CREATE TABLE HR_RECRUITMENT.OFFERS (
    OFFER_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    APP_ID NUMBER(10) NOT NULL,
    OFFER_DATE DATE DEFAULT SYSDATE,
    BASIC_SALARY NUMBER(10, 2),
    HOUSING_ALLOWANCE NUMBER(10, 2),
    TRANSPORT_ALLOWANCE NUMBER(10, 2),
    JOINING_DATE DATE,
    STATUS VARCHAR2(20) DEFAULT 'DRAFT' CHECK (STATUS IN ('DRAFT', 'SENT', 'ACCEPTED', 'DECLINED')),
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_OFFER_APP FOREIGN KEY (APP_ID) REFERENCES HR_RECRUITMENT.APPLICATIONS(APP_ID)
);

-- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
-- =================================================================================
-- المخطط: HR_PERFORMANCE
-- الوصف: تقييم الأداء، الجزاءات، والمخالفات
-- التبعيات: يعتمد على HR_CORE, HR_PERSONNEL
-- =================================================================================

-- ALTER SESSION SET CURRENT_SCHEMA = HR_PERFORMANCE;

-- 1. مكتبة الأهداف ومؤشرات الأداء (KPIs)
CREATE TABLE HR_PERFORMANCE.KPI_LIBRARIES (
    KPI_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    KPI_NAME_AR VARCHAR2(200) NOT NULL,
    KPI_DESCRIPTION VARCHAR2(500),
    CATEGORY VARCHAR2(50), -- مثل: السلوك، الإنتاجية، الجودة
    MEASUREMENT_UNIT VARCHAR2(20), -- نسبة، عدد، وقت
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- 2. دورات التقييم (Appraisal Cycles) - مثلا تقييم 2025
CREATE TABLE HR_PERFORMANCE.APPRAISAL_CYCLES (
    CYCLE_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CYCLE_NAME_AR VARCHAR2(100) NOT NULL, -- تقييم الأداء لعام 2025
    START_DATE DATE NOT NULL,
    END_DATE DATE NOT NULL,
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- 3. تقييم الموظف (الرأس)
CREATE TABLE HR_PERFORMANCE.EMPLOYEE_APPRAISALS (
    APPRAISAL_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    CYCLE_ID NUMBER(5) NOT NULL,
    EVALUATOR_ID NUMBER(10) NOT NULL, -- المدير المقيم
    APPRAISAL_DATE DATE DEFAULT SYSDATE,
    FINAL_SCORE NUMBER(5, 2), -- النتيجة النهائية (من 100 أو 5)
    GRADE VARCHAR2(20), -- ممتاز، جيد جداً
    STATUS VARCHAR2(20) DEFAULT 'DRAFT' CHECK (STATUS IN ('DRAFT', 'SUBMITTED', 'APPROVED', 'ACKNOWLEDGED')),
    EMPLOYEE_COMMENT VARCHAR2(500),
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_APPR_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_APPR_CYCLE FOREIGN KEY (CYCLE_ID) REFERENCES HR_PERFORMANCE.APPRAISAL_CYCLES(CYCLE_ID),
    CONSTRAINT FK_APPR_EVAL FOREIGN KEY (EVALUATOR_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- 4. تفاصيل التقييم (Scores Per KPI)
CREATE TABLE HR_PERFORMANCE.APPRAISAL_DETAILS (
    DETAIL_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    APPRAISAL_ID NUMBER(10) NOT NULL,
    KPI_ID NUMBER(5) NOT NULL,
    TARGET_VALUE NUMBER(10, 2), -- المستهدف
    ACTUAL_VALUE NUMBER(10, 2), -- المحقق
    SCORE NUMBER(5, 2) NOT NULL, -- الدرجة المستحقة
    COMMENTS VARCHAR2(200),
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_DET_APPR FOREIGN KEY (APPRAISAL_ID) REFERENCES HR_PERFORMANCE.EMPLOYEE_APPRAISALS(APPRAISAL_ID),
    CONSTRAINT FK_DET_KPI FOREIGN KEY (KPI_ID) REFERENCES HR_PERFORMANCE.KPI_LIBRARIES(KPI_ID)
);

-- ==========================================
-- المخالفات والجزاءات (Disciplinary)
-- ==========================================

-- 5. أنواع المخالفات
CREATE TABLE HR_PERFORMANCE.VIOLATION_TYPES (
    VIOLATION_TYPE_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    VIOLATION_NAME_AR VARCHAR2(100) NOT NULL, -- تأخير متكرر، غياب، سلوك
    SEVERITY_LEVEL NUMBER(1) DEFAULT 1 CHECK (SEVERITY_LEVEL IN (1, 2, 3)), -- 1 بسيط، 2 متوسط، 3 جسيم
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- 6. لائحة الجزاءات (العقوبات)
CREATE TABLE HR_PERFORMANCE.DISCIPLINARY_ACTIONS (
    ACTION_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ACTION_NAME_AR VARCHAR2(100) NOT NULL, -- إنذار شفهي، إنذار كتابي، خصم يوم
    DEDUCTION_DAYS NUMBER(3, 1) DEFAULT 0, -- عدد أيام الخصم من الراتب
    IS_TERMINATION NUMBER(1) DEFAULT 0, -- هل تؤدي للفصل؟
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- 7. سجل مخالفات الموظفين
CREATE TABLE HR_PERFORMANCE.EMPLOYEE_VIOLATIONS (
    VIOLATION_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    VIOLATION_TYPE_ID NUMBER(3) NOT NULL,
    VIOLATION_DATE DATE NOT NULL,
    DESCRIPTION VARCHAR2(500),
    
    ACTION_ID NUMBER(3), -- العقوبة المتخذة
    IS_EXECUTED NUMBER(1) DEFAULT 0, -- هل تم خصم العقوبة؟
    
    STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'INVESTIGATION', 'APPROVED', 'CANCELLED')),
    INVESTIGATION_NOTES CLOB, -- محضر التحقيق
    
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1,
    
    CONSTRAINT FK_VIOL_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_VIOL_TYPE FOREIGN KEY (VIOLATION_TYPE_ID) REFERENCES HR_PERFORMANCE.VIOLATION_TYPES(VIOLATION_TYPE_ID),
    CONSTRAINT FK_VIOL_ACTION FOREIGN KEY (ACTION_ID) REFERENCES HR_PERFORMANCE.DISCIPLINARY_ACTIONS(ACTION_ID)
);

-- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
-- =================================================================================
-- المخطط: HR_CORE (إضافة جداول النظام)
-- الوصف: جداول النظام العامة (الإعدادات، السجلات، الإشعارات)
-- =================================================================================

-- إعدادات النظام (System Settings)
CREATE TABLE HR_CORE.SYSTEM_SETTINGS (
    SETTING_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    SETTING_KEY VARCHAR2(100) NOT NULL UNIQUE, -- مثل: COMPANY_NAME, FISCAL_YEAR_START
    SETTING_VALUE VARCHAR2(500),
    SETTING_TYPE VARCHAR2(20) CHECK (SETTING_TYPE IN ('STRING', 'NUMBER', 'DATE', 'BOOLEAN')),
    DESCRIPTION_AR VARCHAR2(200),
    IS_EDITABLE NUMBER(1) DEFAULT 1,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- سجل التدقيق الشامل (Audit Log)
CREATE TABLE HR_CORE.AUDIT_LOGS (
    LOG_ID NUMBER(19) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    TABLE_NAME VARCHAR2(100) NOT NULL,
    RECORD_ID NUMBER(15) NOT NULL,
    ACTION_TYPE VARCHAR2(20) CHECK (ACTION_TYPE IN ('INSERT', 'UPDATE', 'DELETE', 'APPROVE', 'REJECT')),
    OLD_VALUE CLOB,
    NEW_VALUE CLOB,
    PERFORMED_BY VARCHAR2(50) NOT NULL,
    PERFORMED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    IP_ADDRESS VARCHAR2(50),
    USER_AGENT VARCHAR2(200)
);

-- الإشعارات (Notifications)
CREATE TABLE HR_CORE.NOTIFICATIONS (
    NOTIFICATION_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    RECIPIENT_ID NUMBER(10) NOT NULL, -- الموظف المستلم
    NOTIFICATION_TYPE VARCHAR2(50) CHECK (NOTIFICATION_TYPE IN ('LEAVE_APPROVAL', 'CONTRACT_EXPIRY', 'DOCUMENT_EXPIRY', 'PAYSLIP_READY', 'GENERAL')),
    TITLE_AR VARCHAR2(200) NOT NULL,
    MESSAGE_AR VARCHAR2(500),
    IS_READ NUMBER(1) DEFAULT 0,
    READ_AT TIMESTAMP,
    PRIORITY VARCHAR2(20) DEFAULT 'NORMAL' CHECK (PRIORITY IN ('LOW', 'NORMAL', 'HIGH', 'URGENT')),
    REFERENCE_TABLE VARCHAR2(100), -- الجدول المرتبط
    REFERENCE_ID NUMBER(15), -- الرقم المرجعي
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- سير العمل والاعتمادات (Workflow Approvals)
CREATE TABLE HR_CORE.WORKFLOW_APPROVALS (
    APPROVAL_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    REQUEST_TYPE VARCHAR2(50) NOT NULL, -- LEAVE_REQUEST, OVERTIME, LOAN
    REQUEST_ID NUMBER(15) NOT NULL,
    APPROVER_LEVEL NUMBER(1) NOT NULL, -- 1: مدير مباشر، 2: HR، 3: مدير عام
    APPROVER_ID NUMBER(10) NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'APPROVED', 'REJECTED', 'DELEGATED')),
    APPROVAL_DATE TIMESTAMP,
    COMMENTS VARCHAR2(500),
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- قوالب التقارير (Report Templates)
CREATE TABLE HR_CORE.REPORT_TEMPLATES (
    TEMPLATE_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    TEMPLATE_NAME_AR VARCHAR2(100) NOT NULL,
    REPORT_TYPE VARCHAR2(50), -- PAYSLIP, LEAVE_BALANCE, ATTENDANCE_SUMMARY
    SQL_QUERY CLOB, -- الاستعلام المخزن
    PARAMETERS CLOB, -- JSON للمعاملات المطلوبة
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    -- Audit Columns
    CREATED_BY VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50),
    UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0,
    VERSION_NO NUMBER(10) DEFAULT 1
);

-- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
