-- -- =================================================================================
-- -- المخطط: HR_PAYROLL
-- -- الوصف: الرواتب، البدلات، الخصومات، ومسيرات الرواتب الشهرية
-- -- =================================================================================

-- -- عناصر الراتب (بدلات وخصومات)
-- CREATE TABLE HR_PAYROLL.SALARY_ELEMENTS (
--     ELEMENT_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     ELEMENT_NAME_AR VARCHAR2(100) NOT NULL,
--     ELEMENT_TYPE VARCHAR2(10) CHECK (ELEMENT_TYPE IN ('EARNING', 'DEDUCTION')),
--     IS_TAXABLE NUMBER(1) DEFAULT 0,
--     IS_GOSI_BASE NUMBER(1) DEFAULT 0,
--     DEFAULT_PERCENTAGE NUMBER(5, 2),
--     IS_RECURRING NUMBER(1) DEFAULT 1,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- هيكل راتب الموظف
-- CREATE TABLE HR_PAYROLL.EMPLOYEE_SALARY_STRUCTURE (
--     STRUCTURE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     ELEMENT_ID NUMBER(3) NOT NULL,
--     AMOUNT NUMBER(10, 2) DEFAULT 0,
--     PERCENTAGE NUMBER(5, 2) DEFAULT 0,
--     IS_ACTIVE NUMBER(1) DEFAULT 1,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_STRUCT_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_STRUCT_ELEM FOREIGN KEY (ELEMENT_ID) REFERENCES HR_PAYROLL.SALARY_ELEMENTS(ELEMENT_ID)
-- );

-- -- السلف والقروض
-- CREATE TABLE HR_PAYROLL.LOANS (
--     LOAN_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     LOAN_AMOUNT NUMBER(10, 2) NOT NULL,
--     REQUEST_DATE DATE DEFAULT SYSDATE,
--     INSTALLMENT_COUNT NUMBER(3) NOT NULL,
--     STATUS VARCHAR2(20) DEFAULT 'ACTIVE' CHECK (STATUS IN ('PENDING', 'ACTIVE', 'CLOSED')),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_LOAN_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
-- );

-- -- مسيرات الرواتب
-- CREATE TABLE HR_PAYROLL.PAYROLL_RUNS (
--     RUN_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     YEAR NUMBER(4) NOT NULL,
--     MONTH NUMBER(2) NOT NULL,
--     RUN_DATE DATE DEFAULT SYSDATE,
--     STATUS VARCHAR2(20) DEFAULT 'DRAFT' CHECK (STATUS IN ('DRAFT', 'APPROVED', 'PAID')),
--     TOTAL_PAYOUT NUMBER(15, 2),
--     NOTES VARCHAR2(200),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- قسيمة راتب الموظف
-- CREATE TABLE HR_PAYROLL.PAYSLIPS (
--     PAYSLIP_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     RUN_ID NUMBER(10) NOT NULL,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     BASIC_SALARY NUMBER(10, 2),
--     TOTAL_ALLOWANCES NUMBER(10, 2),
--     TOTAL_DEDUCTIONS NUMBER(10, 2),
--     NET_SALARY NUMBER(10, 2),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_SLIP_RUN FOREIGN KEY (RUN_ID) REFERENCES HR_PAYROLL.PAYROLL_RUNS(RUN_ID),
--     CONSTRAINT FK_SLIP_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
-- );

-- -- تفاصيل قسيمة الراتب
-- CREATE TABLE HR_PAYROLL.PAYSLIP_DETAILS (
--     DETAIL_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     PAYSLIP_ID NUMBER(15) NOT NULL,
--     ELEMENT_ID NUMBER(3) NOT NULL,
--     ELEMENT_NAME_AR VARCHAR2(100),
--     AMOUNT NUMBER(10, 2) NOT NULL,
--     TYPE VARCHAR2(10),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_DETAIL_SLIP FOREIGN KEY (PAYSLIP_ID) REFERENCES HR_PAYROLL.PAYSLIPS(PAYSLIP_ID)
-- );

-- -- أقساط القروض (Loan Installments)
-- CREATE TABLE HR_PAYROLL.LOAN_INSTALLMENTS (
--     INSTALLMENT_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     LOAN_ID NUMBER(10) NOT NULL,
--     INSTALLMENT_NUMBER NUMBER(3) NOT NULL,
--     DUE_DATE DATE NOT NULL,
--     AMOUNT NUMBER(10, 2) NOT NULL,
--     IS_PAID NUMBER(1) DEFAULT 0,
--     PAID_IN_PAYROLL_RUN NUMBER(10), -- رقم المسير الذي تم فيه الخصم
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
--     CONSTRAINT FK_INST_LOAN FOREIGN KEY (LOAN_ID) REFERENCES HR_PAYROLL.LOANS(LOAN_ID)
-- );

-- -- مكافأة نهاية الخدمة (End of Service Benefits)
-- CREATE TABLE HR_PAYROLL.END_OF_SERVICE_CALC (
--     EOS_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     TERMINATION_DATE DATE NOT NULL,
--     SERVICE_YEARS NUMBER(5, 2) NOT NULL,
--     LAST_BASIC_SALARY NUMBER(10, 2) NOT NULL,
--     TOTAL_AMOUNT NUMBER(12, 2) NOT NULL,
--     CALCULATION_NOTES VARCHAR2(500), -- شرح الحساب
--     IS_PAID NUMBER(1) DEFAULT 0,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
--     CONSTRAINT FK_EOS_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
-- );

-- -- التعديلات اليدوية على الرواتب (Manual Adjustments)
-- CREATE TABLE HR_PAYROLL.PAYROLL_ADJUSTMENTS (
--     ADJUSTMENT_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     PAYROLL_RUN_ID NUMBER(10),
--     ADJUSTMENT_TYPE VARCHAR2(20) CHECK (ADJUSTMENT_TYPE IN ('BONUS', 'DEDUCTION', 'CORRECTION')),
--     AMOUNT NUMBER(10, 2) NOT NULL,
--     REASON VARCHAR2(200) NOT NULL,
--     APPROVED_BY NUMBER(10),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
--     CONSTRAINT FK_ADJ_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_ADJ_RUN FOREIGN KEY (PAYROLL_RUN_ID) REFERENCES HR_PAYROLL.PAYROLL_RUNS(RUN_ID)
-- );
