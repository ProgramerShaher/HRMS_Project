-- =================================================================================
-- سكربت بسيط لإنشاء الجداول الأساسية (Core Tables Only)
-- =================================================================================

-- التأكد من الاتصال بـ PDB
ALTER SESSION SET CONTAINER = XEPDB1;

-- ============ HR_CORE ============
CREATE TABLE HR_CORE.COUNTRIES (
    COUNTRY_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    COUNTRY_NAME_AR VARCHAR2(100) NOT NULL,
    COUNTRY_NAME_EN VARCHAR2(100),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE HR_CORE.DEPARTMENTS (
    DEPT_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DEPT_NAME_AR VARCHAR2(100) NOT NULL,
    DEPT_NAME_EN VARCHAR2(100),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE HR_CORE.JOBS (
    JOB_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    JOB_TITLE_AR VARCHAR2(100) NOT NULL,
    JOB_TITLE_EN VARCHAR2(100),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ============ HR_PERSONNEL ============
CREATE TABLE HR_PERSONNEL.EMPLOYEES (
    EMPLOYEE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_NUMBER VARCHAR2(20) NOT NULL UNIQUE,
    FULL_NAME_AR VARCHAR2(200) NOT NULL,
    FULL_NAME_EN VARCHAR2(200),
    NATIONALITY_ID NUMBER(3),
    JOB_ID NUMBER(5),
    DEPT_ID NUMBER(5),
    JOINING_DATE DATE,
    STATUS VARCHAR2(20) DEFAULT 'ACTIVE',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_EMP_NAT FOREIGN KEY (NATIONALITY_ID) REFERENCES HR_CORE.COUNTRIES(COUNTRY_ID),
    CONSTRAINT FK_EMP_JOB FOREIGN KEY (JOB_ID) REFERENCES HR_CORE.JOBS(JOB_ID),
    CONSTRAINT FK_EMP_DEPT FOREIGN KEY (DEPT_ID) REFERENCES HR_CORE.DEPARTMENTS(DEPT_ID)
);

-- ============ HR_ATTENDANCE ============
CREATE TABLE HR_ATTENDANCE.DAILY_ATTENDANCE (
    RECORD_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    ATTENDANCE_DATE DATE NOT NULL,
    STATUS VARCHAR2(20),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_ATT_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- ============ HR_LEAVES ============
CREATE TABLE HR_LEAVES.LEAVE_REQUESTS (
    REQUEST_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    START_DATE DATE NOT NULL,
    END_DATE DATE NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'PENDING',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_LEAVE_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

-- ============ HR_PAYROLL ============
CREATE TABLE HR_PAYROLL.PAYSLIPS (
    PAYSLIP_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    MONTH NUMBER(2),
    YEAR NUMBER(4),
    NET_SALARY NUMBER(10, 2),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_PAY_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
);

SELECT 'تم إنشاء الجداول الأساسية بنجاح!' AS STATUS FROM DUAL;

-- التحقق
SELECT owner, COUNT(*) as tables 
FROM all_tables 
WHERE owner LIKE 'HR_%' 
GROUP BY owner 
ORDER BY owner;
