-- -- =================================================================================
-- -- المخطط: HR_PERFORMANCE
-- -- الوصف: تقييم الأداء، الجزاءات، والمخالفات
-- -- التبعيات: يعتمد على HR_CORE, HR_PERSONNEL
-- -- =================================================================================

-- -- ALTER SESSION SET CURRENT_SCHEMA = HR_PERFORMANCE;

-- -- 1. مكتبة الأهداف ومؤشرات الأداء (KPIs)
-- CREATE TABLE HR_PERFORMANCE.KPI_LIBRARIES (
--     KPI_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     KPI_NAME_AR VARCHAR2(200) NOT NULL,
--     KPI_DESCRIPTION VARCHAR2(500),
--     CATEGORY VARCHAR2(50), -- مثل: السلوك، الإنتاجية، الجودة
--     MEASUREMENT_UNIT VARCHAR2(20), -- نسبة، عدد، وقت
    
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- 2. دورات التقييم (Appraisal Cycles) - مثلا تقييم 2025
-- CREATE TABLE HR_PERFORMANCE.APPRAISAL_CYCLES (
--     CYCLE_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     CYCLE_NAME_AR VARCHAR2(100) NOT NULL, -- تقييم الأداء لعام 2025
--     START_DATE DATE NOT NULL,
--     END_DATE DATE NOT NULL,
--     IS_ACTIVE NUMBER(1) DEFAULT 1,
    
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- 3. تقييم الموظف (الرأس)
-- CREATE TABLE HR_PERFORMANCE.EMPLOYEE_APPRAISALS (
--     APPRAISAL_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     CYCLE_ID NUMBER(5) NOT NULL,
--     EVALUATOR_ID NUMBER(10) NOT NULL, -- المدير المقيم
--     APPRAISAL_DATE DATE DEFAULT SYSDATE,
--     FINAL_SCORE NUMBER(5, 2), -- النتيجة النهائية (من 100 أو 5)
--     GRADE VARCHAR2(20), -- ممتاز، جيد جداً
--     STATUS VARCHAR2(20) DEFAULT 'DRAFT' CHECK (STATUS IN ('DRAFT', 'SUBMITTED', 'APPROVED', 'ACKNOWLEDGED')),
--     EMPLOYEE_COMMENT VARCHAR2(500),
    
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_APPR_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_APPR_CYCLE FOREIGN KEY (CYCLE_ID) REFERENCES HR_PERFORMANCE.APPRAISAL_CYCLES(CYCLE_ID),
--     CONSTRAINT FK_APPR_EVAL FOREIGN KEY (EVALUATOR_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
-- );

-- -- 4. تفاصيل التقييم (Scores Per KPI)
-- CREATE TABLE HR_PERFORMANCE.APPRAISAL_DETAILS (
--     DETAIL_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     APPRAISAL_ID NUMBER(10) NOT NULL,
--     KPI_ID NUMBER(5) NOT NULL,
--     TARGET_VALUE NUMBER(10, 2), -- المستهدف
--     ACTUAL_VALUE NUMBER(10, 2), -- المحقق
--     SCORE NUMBER(5, 2) NOT NULL, -- الدرجة المستحقة
--     COMMENTS VARCHAR2(200),
    
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_DET_APPR FOREIGN KEY (APPRAISAL_ID) REFERENCES HR_PERFORMANCE.EMPLOYEE_APPRAISALS(APPRAISAL_ID),
--     CONSTRAINT FK_DET_KPI FOREIGN KEY (KPI_ID) REFERENCES HR_PERFORMANCE.KPI_LIBRARIES(KPI_ID)
-- );

-- -- ==========================================
-- -- المخالفات والجزاءات (Disciplinary)
-- -- ==========================================

-- -- 5. أنواع المخالفات
-- CREATE TABLE HR_PERFORMANCE.VIOLATION_TYPES (
--     VIOLATION_TYPE_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     VIOLATION_NAME_AR VARCHAR2(100) NOT NULL, -- تأخير متكرر، غياب، سلوك
--     SEVERITY_LEVEL NUMBER(1) DEFAULT 1 CHECK (SEVERITY_LEVEL IN (1, 2, 3)), -- 1 بسيط، 2 متوسط، 3 جسيم
    
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- 6. لائحة الجزاءات (العقوبات)
-- CREATE TABLE HR_PERFORMANCE.DISCIPLINARY_ACTIONS (
--     ACTION_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     ACTION_NAME_AR VARCHAR2(100) NOT NULL, -- إنذار شفهي، إنذار كتابي، خصم يوم
--     DEDUCTION_DAYS NUMBER(3, 1) DEFAULT 0, -- عدد أيام الخصم من الراتب
--     IS_TERMINATION NUMBER(1) DEFAULT 0, -- هل تؤدي للفصل؟
    
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- 7. سجل مخالفات الموظفين
-- CREATE TABLE HR_PERFORMANCE.EMPLOYEE_VIOLATIONS (
--     VIOLATION_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     VIOLATION_TYPE_ID NUMBER(3) NOT NULL,
--     VIOLATION_DATE DATE NOT NULL,
--     DESCRIPTION VARCHAR2(500),
    
--     ACTION_ID NUMBER(3), -- العقوبة المتخذة
--     IS_EXECUTED NUMBER(1) DEFAULT 0, -- هل تم خصم العقوبة؟
    
--     STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'INVESTIGATION', 'APPROVED', 'CANCELLED')),
--     INVESTIGATION_NOTES CLOB, -- محضر التحقيق
    
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_VIOL_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_VIOL_TYPE FOREIGN KEY (VIOLATION_TYPE_ID) REFERENCES HR_PERFORMANCE.VIOLATION_TYPES(VIOLATION_TYPE_ID),
--     CONSTRAINT FK_VIOL_ACTION FOREIGN KEY (ACTION_ID) REFERENCES HR_PERFORMANCE.DISCIPLINARY_ACTIONS(ACTION_ID)
-- );

-- -- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
