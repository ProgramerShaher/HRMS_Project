-- -- =================================================================================
-- -- المخطط: HR_ATTENDANCE
-- -- الوصف: إدارة المناوبات، الجداول، وسجلات الحضور
-- -- =================================================================================

-- -- 1. جداول الإعداد
-- CREATE TABLE HR_ATTENDANCE.SHIFT_TYPES (
--     SHIFT_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     SHIFT_NAME_AR VARCHAR2(100) NOT NULL,
--     START_TIME CHAR(5) NOT NULL,
--     END_TIME CHAR(5) NOT NULL,
--     HOURS_COUNT NUMBER(4, 2) NOT NULL,
--     IS_CROSS_DAY NUMBER(1) DEFAULT 0,
--     GRACE_PERIOD_MINS NUMBER(3) DEFAULT 15,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- فترات الجداول (الروستر)
-- CREATE TABLE HR_ATTENDANCE.ROSTER_PERIODS (
--     PERIOD_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     YEAR NUMBER(4) NOT NULL,
--     MONTH NUMBER(2) NOT NULL,
--     START_DATE DATE NOT NULL,
--     END_DATE DATE NOT NULL,
--     IS_LOCKED NUMBER(1) DEFAULT 0,
--     LOCKED_BY NUMBER(10),
--     NOTES VARCHAR2(200),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- 2. الجدول المخطط
-- CREATE TABLE HR_ATTENDANCE.EMPLOYEE_ROSTERS (
--     ROSTER_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     ROSTER_DATE DATE NOT NULL,
--     SHIFT_ID NUMBER(3),
--     IS_OFF_DAY NUMBER(1) DEFAULT 0,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_ROSTER_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_ROSTER_SHIFT FOREIGN KEY (SHIFT_ID) REFERENCES HR_ATTENDANCE.SHIFT_TYPES(SHIFT_ID),
--     CONSTRAINT UQ_ROSTER_EMP_DATE UNIQUE (EMPLOYEE_ID, ROSTER_DATE)
-- );

-- -- 3. الحضور الفعلي
-- CREATE TABLE HR_ATTENDANCE.RAW_PUNCH_LOGS (
--     LOG_ID NUMBER(19) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     DEVICE_ID VARCHAR2(50),
--     PUNCH_TIME TIMESTAMP NOT NULL,
--     PUNCH_TYPE VARCHAR2(10) CHECK (PUNCH_TYPE IN ('IN', 'OUT', 'BREAK_IN', 'BREAK_OUT')),
--     IS_PROCESSED NUMBER(1) DEFAULT 0,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_LOG_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
-- );

-- -- 4. الحضور اليومي المعالج
-- CREATE TABLE HR_ATTENDANCE.DAILY_ATTENDANCE (
--     RECORD_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     ATTENDANCE_DATE DATE NOT NULL,
    
--     PLANNED_SHIFT_ID NUMBER(3),
--     ACTUAL_IN_TIME TIMESTAMP,
--     ACTUAL_OUT_TIME TIMESTAMP,
    
--     LATE_MINUTES NUMBER(4) DEFAULT 0,
--     EARLY_LEAVE_MINUTES NUMBER(4) DEFAULT 0,
--     OVERTIME_MINUTES NUMBER(4) DEFAULT 0,
    
--     STATUS VARCHAR2(20) CHECK (STATUS IN ('PRESENT', 'ABSENT', 'LEAVE', 'HOLIDAY', 'MISSING_PUNCH')),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_DAILY_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_DAILY_SHIFT FOREIGN KEY (PLANNED_SHIFT_ID) REFERENCES HR_ATTENDANCE.SHIFT_TYPES(SHIFT_ID)
-- );

-- -- 5. الطلبات
-- CREATE TABLE HR_ATTENDANCE.SHIFT_SWAP_REQUESTS (
--     REQUEST_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     REQUESTER_ID NUMBER(10) NOT NULL,
--     TARGET_EMPLOYEE_ID NUMBER(10) NOT NULL,
--     ROSTER_DATE DATE NOT NULL,
--     STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'APPROVED', 'REJECTED')),
--     MANAGER_COMMENT VARCHAR2(200),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_SWAP_REQ FOREIGN KEY (REQUESTER_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_SWAP_TARGET FOREIGN KEY (TARGET_EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
-- );

-- -- طلبات الساعات الإضافية (مهم للموافقات)
-- CREATE TABLE HR_ATTENDANCE.OVERTIME_REQUESTS (
--     OT_REQUEST_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     REQUEST_DATE DATE DEFAULT SYSDATE,
--     WORK_DATE DATE NOT NULL,
--     HOURS_REQUESTED NUMBER(4, 2) NOT NULL,
--     REASON VARCHAR2(200),
--     STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'APPROVED', 'REJECTED')),
--     APPROVED_BY NUMBER(10),
--     APPROVED_HOURS NUMBER(4, 2), -- قد تختلف عن المطلوبة
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_OT_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_OT_APPROVER FOREIGN KEY (APPROVED_BY) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID)
-- );

-- -- سياسات الحضور حسب القسم/الوظيفة
-- CREATE TABLE HR_ATTENDANCE.ATTENDANCE_POLICIES (
--     POLICY_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     POLICY_NAME_AR VARCHAR2(100) NOT NULL,
--     DEPT_ID NUMBER(5), -- إذا كان NULL فهي سياسة عامة
--     JOB_ID NUMBER(5),
--     LATE_GRACE_MINS NUMBER(3) DEFAULT 15, -- السماح بالتأخير
--     OVERTIME_MULTIPLIER NUMBER(3, 2) DEFAULT 1.5, -- معامل الإضافي
--     WEEKEND_OT_MULTIPLIER NUMBER(3, 2) DEFAULT 2.0,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_POL_DEPT FOREIGN KEY (DEPT_ID) REFERENCES HR_CORE.DEPARTMENTS(DEPT_ID),
--     CONSTRAINT FK_POL_JOB FOREIGN KEY (JOB_ID) REFERENCES HR_CORE.JOBS(JOB_ID)
-- );

-- -- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
