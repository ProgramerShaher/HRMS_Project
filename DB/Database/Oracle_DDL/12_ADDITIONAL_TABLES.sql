-- =================================================================================
-- الجداول الإضافية - إكمال النظام إلى 75 جدول
-- الوحدات: Security, Training, Benefits, Assets
-- =================================================================================

-- للاتصال بـ Oracle 23ai Free
ALTER SESSION SET CONTAINER = FREEPDB1;

PROMPT ========================================
PROMPT إنشاء جداول الأمان والصلاحيات (HR_CORE)
PROMPT ========================================

-- 1. SYSTEM_USERS (المستخدمين)
CREATE TABLE HR_CORE.SYSTEM_USERS (
    USER_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    USERNAME VARCHAR2(50) NOT NULL UNIQUE,
    PASSWORD_HASH VARCHAR2(256) NOT NULL,
    EMPLOYEE_ID NUMBER(10),
    EMAIL VARCHAR2(100) NOT NULL UNIQUE,
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    LAST_LOGIN TIMESTAMP,
    FAILED_LOGIN_ATTEMPTS NUMBER(2) DEFAULT 0,
    ACCOUNT_LOCKED_UNTIL TIMESTAMP,
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 2. SYSTEM_ROLES (الأدوار)
CREATE TABLE HR_CORE.SYSTEM_ROLES (
    ROLE_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ROLE_NAME VARCHAR2(50) NOT NULL UNIQUE,
    ROLE_NAME_AR VARCHAR2(100) NOT NULL,
    DESCRIPTION VARCHAR2(200),
    IS_SYSTEM_ROLE NUMBER(1) DEFAULT 0,
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 3. SYSTEM_PERMISSIONS (الصلاحيات)
CREATE TABLE HR_CORE.SYSTEM_PERMISSIONS (
    PERMISSION_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    PERMISSION_NAME VARCHAR2(100) NOT NULL UNIQUE,
    PERMISSION_NAME_AR VARCHAR2(100) NOT NULL,
    MODULE_NAME VARCHAR2(50) NOT NULL,
    PERMISSION_TYPE VARCHAR2(20) CHECK (PERMISSION_TYPE IN ('VIEW', 'CREATE', 'EDIT', 'DELETE', 'APPROVE')),
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 4. USER_ROLES (ربط المستخدمين بالأدوار)
CREATE TABLE HR_CORE.USER_ROLES (
    USER_ROLE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER(10) NOT NULL,
    ROLE_ID NUMBER(5) NOT NULL,
    ASSIGNED_BY VARCHAR2(50),
    ASSIGNED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT UQ_USER_ROLE UNIQUE (USER_ID, ROLE_ID)
);

-- 5. ROLE_PERMISSIONS (ربط الأدوار بالصلاحيات)
CREATE TABLE HR_CORE.ROLE_PERMISSIONS (
    ROLE_PERMISSION_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ROLE_ID NUMBER(5) NOT NULL,
    PERMISSION_ID NUMBER(10) NOT NULL,
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1,
    CONSTRAINT UQ_ROLE_PERMISSION UNIQUE (ROLE_ID, PERMISSION_ID)
);

PROMPT ========================================
PROMPT إنشاء جداول التدريب (HR_PERSONNEL)
PROMPT ========================================

-- 6. TRAINING_COURSES (الدورات التدريبية)
CREATE TABLE HR_PERSONNEL.TRAINING_COURSES (
    COURSE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    COURSE_NAME_AR VARCHAR2(200) NOT NULL,
    COURSE_NAME_EN VARCHAR2(200),
    PROVIDER_NAME VARCHAR2(200),
    DURATION_DAYS NUMBER(3),
    COST NUMBER(10, 2),
    DESCRIPTION VARCHAR2(500),
    IS_MANDATORY NUMBER(1) DEFAULT 0,
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 7. EMPLOYEE_TRAINING (تدريب الموظفين)
CREATE TABLE HR_PERSONNEL.EMPLOYEE_TRAINING (
    TRAINING_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    COURSE_ID NUMBER(10) NOT NULL,
    START_DATE DATE NOT NULL,
    END_DATE DATE NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'PLANNED' CHECK (STATUS IN ('PLANNED', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED')),
    SCORE NUMBER(5, 2),
    CERTIFICATE_NUMBER VARCHAR2(100),
    CERTIFICATE_PATH VARCHAR2(500),
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

PROMPT ========================================
PROMPT إنشاء جداول المزايا (HR_PAYROLL)
PROMPT ========================================

-- 8. INSURANCE_PLANS (خطط التأمين)
CREATE TABLE HR_PAYROLL.INSURANCE_PLANS (
    PLAN_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    PLAN_NAME_AR VARCHAR2(100) NOT NULL,
    PROVIDER_NAME VARCHAR2(200),
    COVERAGE_TYPE VARCHAR2(50),
    EMPLOYEE_CONTRIBUTION NUMBER(10, 2),
    EMPLOYER_CONTRIBUTION NUMBER(10, 2),
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 9. EMPLOYEE_INSURANCE (تأمين الموظفين)
CREATE TABLE HR_PAYROLL.EMPLOYEE_INSURANCE (
    INSURANCE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    PLAN_ID NUMBER(5) NOT NULL,
    POLICY_NUMBER VARCHAR2(100),
    START_DATE DATE NOT NULL,
    END_DATE DATE,
    STATUS VARCHAR2(20) DEFAULT 'ACTIVE' CHECK (STATUS IN ('ACTIVE', 'EXPIRED', 'CANCELLED')),
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 10. BONUSES (المكافآت)
CREATE TABLE HR_PAYROLL.BONUSES (
    BONUS_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    BONUS_TYPE VARCHAR2(50) NOT NULL,
    AMOUNT NUMBER(10, 2) NOT NULL,
    BONUS_DATE DATE DEFAULT SYSDATE,
    REASON VARCHAR2(200),
    APPROVED_BY NUMBER(10),
    PAYROLL_RUN_ID NUMBER(10),
    IS_PAID NUMBER(1) DEFAULT 0,
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

PROMPT ========================================
PROMPT إنشاء جداول الأصول (HR_CORE)
PROMPT ========================================

-- 11. ASSET_CATEGORIES (فئات الأصول)
CREATE TABLE HR_CORE.ASSET_CATEGORIES (
    CATEGORY_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CATEGORY_NAME_AR VARCHAR2(100) NOT NULL,
    CATEGORY_NAME_EN VARCHAR2(100),
    DESCRIPTION VARCHAR2(200),
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 12. COMPANY_ASSETS (أصول الشركة)
CREATE TABLE HR_CORE.COMPANY_ASSETS (
    ASSET_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ASSET_CODE VARCHAR2(50) NOT NULL UNIQUE,
    ASSET_NAME_AR VARCHAR2(200) NOT NULL,
    CATEGORY_ID NUMBER(5) NOT NULL,
    SERIAL_NUMBER VARCHAR2(100),
    PURCHASE_DATE DATE,
    PURCHASE_PRICE NUMBER(12, 2),
    WARRANTY_EXPIRY DATE,
    STATUS VARCHAR2(20) DEFAULT 'AVAILABLE' CHECK (STATUS IN ('AVAILABLE', 'ASSIGNED', 'MAINTENANCE', 'DISPOSED')),
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 13. EMPLOYEE_ASSETS (أصول الموظفين)
CREATE TABLE HR_PERSONNEL.EMPLOYEE_ASSETS (
    ASSIGNMENT_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    ASSET_ID NUMBER(10) NOT NULL,
    ASSIGNMENT_DATE DATE DEFAULT SYSDATE,
    RETURN_DATE DATE,
    CONDITION_ON_ASSIGNMENT VARCHAR2(50),
    CONDITION_ON_RETURN VARCHAR2(50),
    NOTES VARCHAR2(500),
    STATUS VARCHAR2(20) DEFAULT 'ACTIVE' CHECK (STATUS IN ('ACTIVE', 'RETURNED', 'LOST', 'DAMAGED')),
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

-- 14. EMPLOYEE_TRANSFERS (نقل الموظفين)
CREATE TABLE HR_PERSONNEL.EMPLOYEE_TRANSFERS (
    TRANSFER_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER(10) NOT NULL,
    FROM_DEPT_ID NUMBER(5) NOT NULL,
    TO_DEPT_ID NUMBER(5) NOT NULL,
    FROM_JOB_ID NUMBER(5),
    TO_JOB_ID NUMBER(5),
    TRANSFER_DATE DATE NOT NULL,
    REASON VARCHAR2(200),
    APPROVED_BY NUMBER(10),
    STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'APPROVED', 'REJECTED', 'COMPLETED')),
    CREATED_BY VARCHAR2(50), CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_BY VARCHAR2(50), UPDATED_AT TIMESTAMP,
    IS_DELETED NUMBER(1) DEFAULT 0, VERSION_NO NUMBER(10) DEFAULT 1
);

COMMIT;

PROMPT ========================================
PROMPT تم إنشاء 14 جدول إضافي بنجاح!
PROMPT المجموع الكلي: 75 جدول
PROMPT ========================================

-- التحقق النهائي
SELECT owner, COUNT(*) as table_count 
FROM all_tables 
WHERE owner IN ('HR_CORE', 'HR_PERSONNEL', 'HR_ATTENDANCE', 'HR_LEAVES', 'HR_PAYROLL', 'HR_RECRUITMENT', 'HR_PERFORMANCE')
GROUP BY owner
ORDER BY owner;

SELECT 'إجمالي الجداول: ' || COUNT(*) || ' جدول' AS FINAL_COUNT
FROM all_tables 
WHERE owner IN ('HR_CORE', 'HR_PERSONNEL', 'HR_ATTENDANCE', 'HR_LEAVES', 'HR_PAYROLL', 'HR_RECRUITMENT', 'HR_PERFORMANCE');
