-- -- =================================================================================
-- -- المخطط: HR_LEAVES
-- -- الوصف: إدارة الإجازات، الأرصدة، والعطل الرسمية
-- -- =================================================================================

-- -- أنواع الإجازات
-- CREATE TABLE HR_LEAVES.LEAVE_TYPES (
--     LEAVE_TYPE_ID NUMBER(3) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     LEAVE_NAME_AR VARCHAR2(100) NOT NULL,
--     IS_PAID NUMBER(1) DEFAULT 1,
--     MAX_DAYS_PER_YEAR NUMBER(3),
--     REQUIRES_ATTACHMENT NUMBER(1) DEFAULT 0,
--     IS_CARRY_FORWARD NUMBER(1) DEFAULT 0,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- أرصدة إجازات الموظفين
-- CREATE TABLE HR_LEAVES.EMPLOYEE_LEAVE_BALANCES (
--     BALANCE_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     LEAVE_TYPE_ID NUMBER(3) NOT NULL,
--     CURRENT_BALANCE NUMBER(5, 2) DEFAULT 0,
--     YEAR NUMBER(4) NOT NULL,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_BAL_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_BAL_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID),
--     CONSTRAINT UQ_BAL_EMP_TYPE_YEAR UNIQUE (EMPLOYEE_ID, LEAVE_TYPE_ID, YEAR)
-- );

-- -- طلبات الإجازة
-- CREATE TABLE HR_LEAVES.LEAVE_REQUESTS (
--     REQUEST_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     LEAVE_TYPE_ID NUMBER(3) NOT NULL,
--     START_DATE DATE NOT NULL,
--     END_DATE DATE NOT NULL,
--     DAYS_COUNT NUMBER(3) NOT NULL,
--     REASON VARCHAR2(200),
--     ATTACHMENT_PATH VARCHAR2(500),
    
--     STATUS VARCHAR2(20) DEFAULT 'PENDING' CHECK (STATUS IN ('PENDING', 'MANAGER_APPROVED', 'HR_APPROVED', 'REJECTED')),
--     REJECTION_REASON VARCHAR2(200),
    
--     IS_POSTED_TO_BALANCE NUMBER(1) DEFAULT 0,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
    
--     CONSTRAINT FK_REQ_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_REQ_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID)
-- );

-- -- العطل الرسمية
-- CREATE TABLE HR_LEAVES.PUBLIC_HOLIDAYS (
--     HOLIDAY_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     HOLIDAY_NAME_AR VARCHAR2(100) NOT NULL,
--     START_DATE DATE NOT NULL,
--     END_DATE DATE NOT NULL,
--     YEAR NUMBER(4) NOT NULL,
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1
-- );

-- -- قواعد استحقاق الإجازات (Accrual Rules)
-- CREATE TABLE HR_LEAVES.LEAVE_ACCRUAL_RULES (
--     RULE_ID NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     LEAVE_TYPE_ID NUMBER(3) NOT NULL,
--     ACCRUAL_FREQUENCY VARCHAR2(20) CHECK (ACCRUAL_FREQUENCY IN ('MONTHLY', 'YEARLY', 'JOINING_DATE')),
--     DAYS_PER_PERIOD NUMBER(5, 2) NOT NULL, -- مثلاً 2.5 يوم شهرياً
--     MAX_ACCUMULATION NUMBER(3), -- الحد الأقصى للتراكم
--     IS_PRORATED NUMBER(1) DEFAULT 1, -- هل يُحسب بالتناسب للموظف الجديد؟
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
--     CONSTRAINT FK_ACCR_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID)
-- );

-- -- صرف الإجازات نقداً (Encashment)
-- CREATE TABLE HR_LEAVES.LEAVE_ENCASHMENT (
--     ENCASH_ID NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     LEAVE_TYPE_ID NUMBER(3) NOT NULL,
--     DAYS_ENCASHED NUMBER(5, 2) NOT NULL,
--     AMOUNT NUMBER(10, 2) NOT NULL, -- المبلغ المدفوع
--     ENCASH_DATE DATE DEFAULT SYSDATE,
--     PAYROLL_RUN_ID NUMBER(10), -- ربط بمسير الراتب
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
--     CONSTRAINT FK_ENCASH_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_ENCASH_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID)
-- );

-- -- سجل حركات الرصيد (Transactions Log)
-- CREATE TABLE HR_LEAVES.LEAVE_TRANSACTIONS (
--     TRANSACTION_ID NUMBER(15) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
--     EMPLOYEE_ID NUMBER(10) NOT NULL,
--     LEAVE_TYPE_ID NUMBER(3) NOT NULL,
--     TRANSACTION_TYPE VARCHAR2(20) CHECK (TRANSACTION_TYPE IN ('ACCRUAL', 'DEDUCTION', 'ADJUSTMENT', 'CARRY_FORWARD')),
--     DAYS NUMBER(5, 2) NOT NULL, -- موجب للإضافة، سالب للخصم
--     TRANSACTION_DATE DATE DEFAULT SYSDATE,
--     REFERENCE_ID NUMBER(10), -- قد يشير لطلب إجازة أو عملية أخرى
--     NOTES VARCHAR2(200),
--     -- Audit Columns
--     CREATED_BY VARCHAR2(50),
--     CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
--     UPDATED_BY VARCHAR2(50),
--     UPDATED_AT TIMESTAMP,
--     IS_DELETED NUMBER(1) DEFAULT 0,
--     VERSION_NO NUMBER(10) DEFAULT 1,
--     CONSTRAINT FK_TRANS_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES HR_PERSONNEL.EMPLOYEES(EMPLOYEE_ID),
--     CONSTRAINT FK_TRANS_TYPE FOREIGN KEY (LEAVE_TYPE_ID) REFERENCES HR_LEAVES.LEAVE_TYPES(LEAVE_TYPE_ID)
-- );

-- -- ملاحظة: الصلاحيات سيتم منحها في ملف منفصل
