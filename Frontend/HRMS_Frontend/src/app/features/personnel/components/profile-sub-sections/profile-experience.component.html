<div class="bg-white dark:bg-zinc-900 rounded-lg border border-slate-200 dark:border-zinc-800 overflow-hidden">
    <!-- Header -->
    <div class="px-4 py-2 border-b border-slate-100 dark:border-zinc-800 flex justify-between items-center bg-slate-50 dark:bg-zinc-900">
        <h3 class="font-bold text-sm text-slate-700 dark:text-white flex items-center gap-2">
            <i class="pi pi-briefcase text-teal-500 text-sm"></i>
            الخبرات السابقة
        </h3>
        <button pButton icon="pi pi-plus" class="p-button-text p-button-sm !w-6 !h-6 !p-0 text-slate-500 hover:text-blue-600" (click)="showDialog()"></button>
    </div>

    <!-- Table -->
    <p-table [value]="experiences()" [loading]="loading()" styleClass="p-datatable-sm text-xs" [rowHover]="true">
        <ng-template pTemplate="header">
            <tr class="text-xs text-slate-500 bg-slate-50/50">
                <th class="!p-2 font-medium">المسمى الوظيفي</th>
                <th class="!p-2 font-medium">جهة العمل</th>
                <th class="!p-2 font-medium">الفترة</th>
                <th class="!p-2 w-16 text-center"></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-exp>
            <tr class="border-b border-slate-50 last:border-0 hover:bg-slate-50/50 transition-colors">
                <td class="!p-2 font-bold text-slate-700">{{ exp.jobTitleAr }}</td>
                <td class="!p-2">
                    <span class="px-1.5 py-0.5 rounded bg-teal-50 text-teal-600 text-[10px] font-bold border border-teal-100">{{ exp.companyNameAr }}</span>
                </td>
                <td class="!p-2">
                    <div class="flex items-center gap-1 text-[10px] text-slate-500 font-mono">
                        <span>{{ exp.startDate | date:'MM/yyyy' }}</span>
                        <i class="pi pi-arrow-left text-[8px]"></i>
                        <span *ngIf="exp.isCurrent" class="text-green-600 font-bold">الآن</span>
                        <span *ngIf="!exp.isCurrent">{{ exp.endDate | date:'MM/yyyy' }}</span>
                    </div>
                </td>
                <td class="!p-2 text-center">
                    <div class="flex justify-center gap-1">
                        <button pButton icon="pi pi-trash" class="p-button-text p-button-danger !w-6 !h-6 !p-0 !text-xs opacity-50 hover:opacity-100" (click)="delete(exp.experienceId)"></button>
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="4" class="text-center py-4 text-slate-400 text-xs">
                    لا توجد خبرات سابقة
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- Dialog -->
<p-dialog [(visible)]="displayDialog" [header]="'إضافة خبرة عملية'" [modal]="true" [style]="{width: '600px'}" styleClass="p-fluid">
    <form [formGroup]="expForm" class="flex flex-col gap-4 mt-2">
        
        <div class="field">
            <label class="block text-sm font-medium mb-1">اسم الشركة / الجهة <span class="text-red-500">*</span></label>
            <input pInputText formControlName="companyNameAr" placeholder="مثال: شركة أرامكو" />
            <small class="text-red-500" *ngIf="submitted && expForm.get('companyNameAr')?.invalid">مطلوب</small>
        </div>

        <div class="field">
            <label class="block text-sm font-medium mb-1">المسمى الوظيفي <span class="text-red-500">*</span></label>
            <input pInputText formControlName="jobTitleAr" placeholder="مثال: مهندس برمجيات" />
            <small class="text-red-500" *ngIf="submitted && expForm.get('jobTitleAr')?.invalid">مطلوب</small>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="field">
                <label class="block text-sm font-medium mb-1">تاريخ البدء <span class="text-red-500">*</span></label>
                <p-datePicker formControlName="startDate" appendTo="body" dateFormat="dd/mm/yy"></p-datePicker>
            </div>
            <div class="field">
                <label class="block text-sm font-medium mb-1">تاريخ الانتهاء</label>
                <p-datePicker formControlName="endDate" appendTo="body" dateFormat="dd/mm/yy"></p-datePicker>
            </div>
        </div>

        <div class="field-checkbox flex items-center gap-2">
            <p-checkbox formControlName="isCurrent" [binary]="true" inputId="isCurrent" (onChange)="onCurrentChange()"></p-checkbox>
            <label for="isCurrent" class="mb-0">ما زلت أعمل هنا</label>
        </div>

        <div class="field">
            <label class="block text-sm font-medium mb-1">المسؤوليات / المهام</label>
            <textarea pTextarea formControlName="responsibilities" rows="3" class="w-full"></textarea>
        </div>

        <div class="field">
            <label class="block text-sm font-medium mb-1">سبب ترك العمل</label>
            <input pInputText formControlName="reasonForLeaving" />
        </div>

    </form>
    <ng-template pTemplate="footer">
        <button pButton label="إلغاء" icon="pi pi-times" class="p-button-text" (click)="displayDialog = false"></button>
        <button pButton label="حفظ" icon="pi pi-check" (click)="save()" [loading]="loading()"></button>
    </ng-template>
</p-dialog>

<p-confirmDialog [style]="{width: '450px'}" [rtl]="true"></p-confirmDialog>
<p-toast position="bottom-left"></p-toast>
