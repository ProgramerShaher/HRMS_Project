<div class="space-y-8 animate-in fade-in slide-in-from-bottom-5 duration-500">
  
  <!-- Header Card (Compact & Modern) -->
  <div class="bg-indigo-600 rounded-[2.5rem] p-8 text-white shadow-xl shadow-indigo-500/20 relative overflow-hidden group">
    <div class="absolute -top-10 -right-10 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
    <div class="relative z-10 flex items-center gap-6">
      <div class="w-16 h-16 rounded-2xl bg-white/10 backdrop-blur-md flex items-center justify-center text-white border border-white/20">
        <i class="pi pi-users text-3xl"></i>
      </div>
      <div>
        <h2 class="text-2xl font-black tracking-tight">العائلة وجهات الطوارئ</h2>
        <p class="text-sm text-indigo-100/80 font-medium">إدارة المرافقين ومعلومات الاتصال في الحالات العاجلة</p>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Emergency Contacts Section -->
    <section class="space-y-4">
      <app-dynamic-array-list
        [items]="data.emergencyContacts || []"
        title="جهات الاتصال للطوارئ"
        itemLabel="جهة اتصال"
        icon="pi pi-phone"
        [columns]="contactColumns"
        (save)="onSaveContact($event)"
        (delete)="onDeleteContact($event)">
        
        <ng-template #formTemplate let-item>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5 p-2">
            <!-- Name -->
            <div class="md:col-span-2 space-y-1.5">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mr-1">الاسم الكامل <span class="text-red-500">*</span></label>
              <input pInputText [(ngModel)]="item.contactNameAr" class="w-full !h-11 !rounded-xl !bg-slate-50 dark:!bg-slate-900/50 !text-sm !font-bold" placeholder="الاسم الرباعي المعتمد" />
            </div>

            <!-- Phone -->
            <div class="space-y-1.5">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mr-1">رقم الجوال <span class="text-red-500">*</span></label>
              <div class="relative group" dir="ltr">
              <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-black text-[10px]">+967</span>
              <input pInputText [(ngModel)]="item.phonePrimary" (onBlur)="onDataChange()" maxlength="9" class="w-full !h-11 !pl-11 !rounded-xl !bg-slate-50 dark:!bg-slate-900/50 font-mono text-sm" placeholder="7XXXXXXXX" />
            </div>
            </div>

            <!-- Relationship -->
            <div class="space-y-1.5">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mr-1">صلة القرابة</label>
              <input pInputText [(ngModel)]="item.relationship" class="w-full !h-11 !rounded-xl !bg-slate-50 dark:!bg-slate-900/50 !text-sm" placeholder="مثال: أب، زوج..." />
            </div>

            <!-- Is Primary -->
            <div class="md:col-span-2">
               <div class="flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/10 rounded-xl border border-blue-100 dark:border-blue-900/40">
                 <input type="checkbox" [(ngModel)]="item.isPrimary" class="w-4 h-4 accent-blue-600 rounded" id="isPrimaryContact" />
                 <label for="isPrimaryContact" class="text-[11px] font-bold text-blue-800 dark:text-blue-400">جهة الاتصال الأساسية</label>
               </div>
            </div>
          </div>
        </ng-template>
      </app-dynamic-array-list>
    </section>

    <!-- Dependents Section -->
    <section class="space-y-4">
      <app-dynamic-array-list
        [items]="data.dependents || []"
        title="أفراد العائلة (المرافقين)"
        itemLabel="مرافق"
        icon="pi pi-heart"
        [columns]="dependentColumns"
        (save)="onSaveDependent($event)"
        (delete)="onDeleteDependent($event)">
        
        <ng-template #formTemplate let-item>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5 p-2">
            <!-- Name -->
            <div class="md:col-span-2 space-y-1.5">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mr-1">الاسم الكامل للمرافق</label>
              <input pInputText [(ngModel)]="item.fullNameAr" class="w-full !h-11 !rounded-xl !bg-slate-50 dark:!bg-slate-900/50 !text-sm !font-bold" />
            </div>

            <!-- National ID -->
            <div class="space-y-1.5">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mr-1">رقم الهوية</label>
              <input pInputText [(ngModel)]="item.nationalId" maxlength="10" class="w-full !h-11 !rounded-xl !bg-slate-50 dark:!bg-slate-900/50 font-mono text-sm tracking-widest" />
            </div>

            <!-- Birth Date -->
            <div class="space-y-1.5">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mr-1">تاريخ الميلاد</label>
              <p-datePicker [(ngModel)]="item.birthDate" [showIcon]="true" appendTo="body" dateFormat="yy-mm-dd" styleClass="w-full" inputStyleClass="!h-11 !rounded-xl !bg-slate-50 dark:!bg-slate-900/50 !text-sm"></p-datePicker>
            </div>

            <!-- Relationship -->
            <div class="space-y-1.5">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mr-1">صلة القرابة</label>
              <input pInputText [(ngModel)]="item.relationship" class="w-full !h-11 !rounded-xl !bg-slate-50 dark:!bg-slate-900/50 !text-sm" />
            </div>

            <!-- Gender -->
            <div class="space-y-1.5">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mr-1">الجنس</label>
              <div class="flex gap-2 h-11">
                @for (gender of genders; track gender.value) {
                  <button class="flex-1 flex items-center justify-center gap-2 rounded-xl border-2 transition-all font-bold text-[10px]"
                    [ngClass]="item.gender === gender.value ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-slate-50 bg-slate-50 text-slate-400'"
                    (click)="item.gender = gender.value">
                    {{ gender.label }}
                  </button>
                }
              </div>
            </div>
          </div>
        </ng-template>
      </app-dynamic-array-list>
    </section>
  </div>
</div>
