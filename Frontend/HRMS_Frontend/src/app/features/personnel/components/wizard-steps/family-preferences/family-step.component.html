<div class="space-y-8 animate-in fade-in slide-in-from-bottom-5 duration-700">

  <!-- Clean Header Section -->
  <div
    class="bg-white dark:bg-slate-900 rounded-2xl p-6 border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col md:flex-row justify-between items-center gap-6">
    <div class="flex items-center gap-5">
      <div
        class="w-12 h-12 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 flex items-center justify-center text-indigo-600 dark:text-indigo-400">
        <i class="pi pi-users text-2xl"></i>
      </div>
      <div>
        <h2 class="text-xl font-bold text-slate-800 dark:text-white leading-tight">العائلة وسجل الطوارئ</h2>
        <p class="text-sm text-slate-500 dark:text-slate-400 mt-1 font-medium">
          إدارة بيانات المرافقين ومعلومات التواصل السريع في الحالات الطارئة
        </p>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <span
        class="px-3 py-1.5 bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-300 text-xs font-bold rounded-lg border border-slate-100 dark:border-slate-700">
        Family & Emergency
      </span>
    </div>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 items-start">

    <!-- Emergency Contacts Section -->
    <section>
      <app-dynamic-array-list [items]="data.emergencyContacts || []" title="جهات الاتصال للطوارئ" itemLabel="جهة اتصال"
        icon="pi pi-phone" [columns]="contactColumns" (save)="onSaveContact($event)" (delete)="onDeleteContact($event)">

        <ng-template #formTemplate let-item>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-2">
            <!-- Name -->
            <div class="md:col-span-2 space-y-2">
              <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300">الاسم الكامل لجهة الاتصال
                <span class="text-red-500">*</span></label>
              <input pInputText [(ngModel)]="item.contactNameAr" placeholder="الاسم الرباعي المعتمد"
                class="w-full !h-11 !rounded-lg !bg-white dark:!bg-slate-900 !border-slate-300 dark:!border-slate-700 !text-sm focus:!border-blue-500 focus:!ring-1 focus:!ring-blue-500 transition-all" />
            </div>

            <!-- Phone -->
            <div class="space-y-2">
              <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300">رقم الهاتف (+967) <span
                  class="text-red-500">*</span></label>
              <div class="relative flex items-center" dir="ltr">
                <div
                  class="absolute left-0 top-0 bottom-0 px-3 bg-slate-100 dark:bg-slate-800 border-r border-slate-300 dark:border-slate-700 rounded-l-lg flex items-center justify-center">
                  <span class="text-xs font-bold text-slate-600 dark:text-slate-400">+967</span>
                </div>
                <input pInputText [(ngModel)]="item.phonePrimary" maxlength="9" placeholder="7XXXXXXXX"
                  class="w-full !h-11 !pl-14 !rounded-lg !bg-white dark:!bg-slate-900 !border-slate-300 dark:!border-slate-700 !text-sm font-mono tracking-wider focus:!border-blue-500 focus:!ring-1 focus:!ring-blue-500 transition-all" />
              </div>
            </div>

            <!-- Relationship -->
            <div class="space-y-2">
              <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300">صلة القرابة</label>
              <input pInputText [(ngModel)]="item.relationship" placeholder="مثال: أب، زوج، أخ..."
                class="w-full !h-11 !rounded-lg !bg-white dark:!bg-slate-900 !border-slate-300 dark:!border-slate-700 !text-sm focus:!border-blue-500 focus:!ring-1 focus:!ring-blue-500 transition-all" />
            </div>

            <!-- Is Primary -->
            <div class="md:col-span-2 pt-2">
              <div
                class="flex items-center gap-3 p-4 rounded-xl border border-indigo-100 dark:border-indigo-900/30 bg-indigo-50/50 dark:bg-indigo-900/10">
                <p-checkbox [(ngModel)]="item.isPrimary" binary="true" inputId="isPrimaryContact"></p-checkbox>
                <label for="isPrimaryContact"
                  class="text-xs font-semibold text-slate-700 dark:text-slate-300 cursor-pointer select-none">اعتماد
                  كجهة اتصال أساسية في حالات الطوارئ</label>
              </div>
            </div>
          </div>
        </ng-template>
      </app-dynamic-array-list>
    </section>

    <!-- Dependents Section -->
    <section>
      <app-dynamic-array-list [items]="data.dependents || []" title="سجل المرافقين" itemLabel="فرد من العائلة"
        icon="pi pi-heart-fill" [columns]="dependentColumns" (save)="onSaveDependent($event)"
        (delete)="onDeleteDependent($event)">

        <ng-template #formTemplate let-item>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-2">
            <!-- Name -->
            <div class="md:col-span-2 space-y-2">
              <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300">الاسم الكامل للمرافق</label>
              <input pInputText [(ngModel)]="item.fullNameAr" placeholder="كما هو مسجل في البطاقة العائلية"
                class="w-full !h-11 !rounded-lg !bg-white dark:!bg-slate-900 !border-slate-300 dark:!border-slate-700 !text-sm focus:!border-blue-500 focus:!ring-1 focus:!ring-blue-500 transition-all" />
            </div>

            <!-- National ID -->
            <div class="space-y-2">
              <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 font-sans">National ID</label>
              <input pInputText [(ngModel)]="item.nationalId" maxlength="11" placeholder="1XXXXXXXXX"
                class="w-full !h-11 !rounded-lg !bg-white dark:!bg-slate-900 !border-slate-300 dark:!border-slate-700 !text-sm font-mono tracking-wider focus:!border-blue-500 focus:!ring-1 focus:!ring-blue-500 transition-all" />
            </div>

            <!-- Birth Date -->
            <div class="space-y-2">
              <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300">تاريخ الميلاد</label>
              <p-datePicker [(ngModel)]="item.birthDate" [showIcon]="true" appendTo="body" dateFormat="yy-mm-dd"
                styleClass="w-full"
                inputStyleClass="!h-11 !rounded-lg !bg-white dark:!bg-slate-900 !border-slate-300 dark:!border-slate-700 !text-sm focus:!border-blue-500 focus:!ring-1 focus:!ring-blue-500 transition-all"></p-datePicker>
            </div>

            <!-- Relationship -->
            <div class="space-y-2">
              <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300">صلة القرابة</label>
              <input pInputText [(ngModel)]="item.relationship" placeholder="مثال: ابن، ابنة..."
                class="w-full !h-11 !rounded-lg !bg-white dark:!bg-slate-900 !border-slate-300 dark:!border-slate-700 !text-sm focus:!border-blue-500 focus:!ring-1 focus:!ring-blue-500 transition-all" />
            </div>

            <!-- Gender -->
            <div class="space-y-2">
              <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300">الجنس</label>
              <p-select [options]="genders" [(ngModel)]="item.gender" optionLabel="label" optionValue="value"
                appendTo="body" placeholder="اختر الجنس"
                styleClass="w-full !rounded-lg !h-11 !text-sm shadow-none !border-slate-300 dark:!border-slate-700 focus:!border-blue-500 focus:!ring-1 focus:!ring-blue-500 transition-all"></p-select>
            </div>
          </div>
        </ng-template>
      </app-dynamic-array-list>
    </section>
  </div>
</div>