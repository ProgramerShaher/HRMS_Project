<div class="p-6 space-y-6 animate-in fade-in duration-500">
  <!-- Header -->
  <div class="glass-panel p-6 rounded-2xl flex flex-col md:flex-row md:items-center justify-between gap-4 border-none shadow-sm">
    <div>
      <h1 class="text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight flex items-center gap-3">
        <i class="pi pi-check-square text-emerald-600"></i>
        اعتمادات الإجازات
      </h1>
      <p class="text-slate-500 dark:text-zinc-400 mt-1">مراجعة ومعالجة طلبات الإجازات المقدمة من قبل أعضاء الفريق.</p>
    </div>
    <div class="flex items-center gap-2">
      <span class="px-4 py-2 bg-emerald-50 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 rounded-xl text-sm font-bold">
        {{ pendingRequests().length }} طلبات معلقة
      </span>
      <p-button icon="pi pi-refresh" [text]="true" [rounded]="true" (click)="loadPendingRequests()" [loading]="loading()"></p-button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="glass-panel rounded-2xl border-none shadow-sm overflow-hidden bg-white dark:bg-zinc-900">
    <p-table 
      [value]="pendingRequests()" 
      [paginator]="true" 
      [rows]="10"
      [loading]="loading()"
      responsiveLayout="scroll"
      styleClass="p-datatable-lg custom-table">
      
      <ng-template pTemplate="header">
        <tr>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4">الموظف</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4">نوع الإجازة</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">الفترة</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">الأيام</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4">السبب</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">الإجراءات</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-request>
        <tr class="hover:bg-slate-50/50 dark:hover:bg-zinc-800/30 transition-colors">
          <td class="py-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center text-blue-600 dark:text-blue-400 font-bold">
                {{ request.employeeName?.charAt(0) }}
              </div>
              <div>
                <div class="font-bold text-slate-900 dark:text-white">{{ request.employeeName }}</div>
                <div class="text-xs text-slate-500">مشرف مباشر</div>
              </div>
            </div>
          </td>
          <td class="py-4">
            <span class="px-3 py-1 bg-slate-100 dark:bg-zinc-800 text-slate-700 dark:text-zinc-300 rounded-lg text-xs font-semibold">
              {{ request.leaveTypeName }}
            </span>
          </td>
          <td class="py-4 text-center">
            <div class="text-sm font-medium text-slate-700 dark:text-zinc-300">
               {{ request.startDate | date: 'dd/MM/yyyy' }}
              <i class="pi pi-arrow-left text-[10px] mx-1 opacity-40"></i>
              {{ request.endDate | date: 'dd/MM/yyyy' }}
            </div>
          </td>
          <td class="py-4 text-center">
            <span class="text-lg font-black text-slate-900 dark:text-white">{{ request.daysCount }}</span>
          </td>
          <td class="py-4">
            <div class="text-xs text-slate-500 max-w-[200px] truncate" [title]="request.reason">
              {{ request.reason }}
            </div>
          </td>
          <td class="py-4">
            <div class="flex justify-center gap-2">
              <p-button icon="pi pi-check" label="موافقة" 
                      severity="success" size="small" styleClass="rounded-xl px-4"
                      (click)="approve(request)"></p-button>
              <p-button icon="pi pi-times" label="رفض" 
                      severity="danger" [outlined]="true" size="small" styleClass="rounded-xl px-4"
                      (click)="reject(request)"></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center py-20 text-slate-400">
            <div class="flex flex-col items-center gap-4">
              <i class="pi pi-inbox text-6xl opacity-20"></i>
              <div class="text-xl font-bold">لا يوجد طلبات معلقة حالياً</div>
              <p class="text-sm">سيتم عرض جميع الطلبات التي تحتاج إلى موافقتك هنا.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Rejection Reason Dialog -->
<p-dialog [(visible)]="showRejectDialog" [header]="'سبب رفض الإجازة'" [modal]="true" [style]="{width: '450px'}" styleClass="custom-dialog">
  <div class="p-4 space-y-4">
    <div class="space-y-2">
      <label class="block text-sm font-bold text-slate-700">يرجى كتابة سبب الرفض ليتم إرساله للموظف:</label>
      <textarea pTextarea [(ngModel)]="rejectionReason" rows="4" class="w-full rounded-xl border-slate-200" placeholder="اكتب السبب هنا..."></textarea>
    </div>
    <div class="flex justify-end gap-2 pt-4">
      <p-button label="إلغاء" [text]="true" (click)="showRejectDialog = false"></p-button>
      <p-button label="تأكيد الرفض" severity="danger" styleClass="rounded-xl px-6" [disabled]="!rejectionReason" (click)="confirmReject()"></p-button>
    </div>
  </div>
</p-dialog>
