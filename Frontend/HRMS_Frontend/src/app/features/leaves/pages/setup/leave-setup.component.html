<div class="p-6 space-y-6 animate-in fade-in duration-500">
  <!-- Header -->
  <div class="glass-panel p-6 rounded-2xl flex flex-col md:flex-row md:items-center justify-between gap-4 border-none shadow-sm">
    <div>
      <h1 class="text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight flex items-center gap-3">
        <i class="pi pi-cog text-slate-600"></i>
        إعدادات الإجازات
      </h1>
      <p class="text-slate-500 dark:text-zinc-400 mt-1">تعريف أنواع الإجازات، السياسات، والمدد الزمنية للنظام.</p>
    </div>
    <div class="flex items-center gap-3">
      <button pButton icon="pi pi-plus" label="إضافة نوع جديد" 
              class="p-button-raised p-button-primary rounded-xl px-6"
              (click)="showCreateModal()"></button>
    </div>
  </div>

  <!-- Table -->
  <div class="glass-panel rounded-2xl border-none shadow-sm overflow-hidden bg-white dark:bg-zinc-900">
    <p-table 
      [value]="leaveTypes()" 
      [loading]="loading()"
      responsiveLayout="scroll"
      styleClass="p-datatable-lg custom-table">
      
      <ng-template pTemplate="header">
        <tr>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4">اسم الإجازة</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">المدة الافتراضية</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">مدفوعة</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">تتطلب موافقة</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">ترحيل الرصيد</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">الحالة</th>
          <th class="bg-slate-50 dark:bg-zinc-800/50 text-slate-700 dark:text-zinc-300 font-bold py-4 text-center">إجراءات</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-type>
        <tr class="hover:bg-slate-50/50 dark:hover:bg-zinc-800/30 transition-colors">
          <td class="py-4">
            <div class="font-bold text-slate-900 dark:text-white">{{ type.leaveNameAr }}</div>
            <div class="text-xs text-slate-500">{{ type.leaveNameEn }}</div>
          </td>
          <td class="py-4 text-center font-bold">{{ type.defaultDays }} أيام</td>
          <td class="py-4 text-center">
            <i class="pi" [ngClass]="type.isPaid ? 'p-check-circle text-emerald-500' : 'pi-times-circle text-rose-500'"></i>
          </td>
          <td class="py-4 text-center">
             <i class="pi" [ngClass]="type.requiresApproval ? 'pi-lock text-blue-500' : 'pi-lock-open text-slate-400'"></i>
          </td>
          <td class="py-4 text-center">
            <span *ngIf="type.allowCarryForward" class="text-emerald-600 font-bold text-xs">نعم ({{ type.maxCarryForwardDays || '-' }})</span>
            <span *ngIf="!type.allowCarryForward" class="text-slate-400 text-xs">لا</span>
          </td>
          <td class="py-4 text-center">
            <p-tag [severity]="type.isActive ? 'success' : 'danger'" [value]="type.isActive ? 'نشط' : 'معطل'"></p-tag>
          </td>
          <td class="py-4">
            <div class="flex justify-center gap-1">
              <button pButton icon="pi pi-pencil" class="p-button-text p-button-rounded p-button-sm" (click)="edit(type)"></button>
              <button pButton icon="pi pi-trash" class="p-button-text p-button-rounded p-button-sm p-button-danger" (click)="deleteType(type.leaveTypeId)"></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Add/Edit Dialog -->
<p-dialog [(visible)]="showModal" [header]="editMode ? 'تعديل نوع إجازة' : 'إضافة نوع إجازة جديد'" [modal]="true" [style]="{width: '600px'}" styleClass="custom-dialog">
  <form [formGroup]="typeForm" (ngSubmit)="save()" class="p-4 space-y-4">
    <div class="grid grid-cols-2 gap-4">
      <div class="space-y-1.5 col-span-2 md:col-span-1">
        <label class="block text-sm font-bold text-slate-700">الاسم (عربي) *</label>
        <input pInputText formControlName="leaveNameAr" class="w-full rounded-xl" placeholder="مثلاً: إجازة سنوية">
      </div>
      <div class="space-y-1.5 col-span-2 md:col-span-1">
        <label class="block text-sm font-bold text-slate-700">الاسم (انجليزي) *</label>
        <input pInputText formControlName="leaveNameEn" class="w-full rounded-xl" placeholder="e.g. Annual Leave">
      </div>
    </div>

    <div class="grid grid-cols-3 gap-4">
      <div class="space-y-1.5">
        <label class="block text-sm font-bold text-slate-700">المدة الافتراضية</label>
        <p-inputNumber formControlName="defaultDays" class="w-full" [min]="0"></p-inputNumber>
      </div>
      <div class="flex items-center gap-2 pt-6">
        <p-toggleButton formControlName="isPaid" onLabel="مدفوعة" offLabel="خصم" onIcon="pi pi-check" offIcon="pi pi-times"></p-toggleButton>
      </div>
      <div class="flex items-center gap-2 pt-6">
        <p-toggleButton formControlName="requiresApproval" onLabel="موافقة" offLabel="تلقائي" onIcon="pi pi-lock" offIcon="pi pi-lock-open"></p-toggleButton>
      </div>
    </div>

    <div class="flex gap-4 p-4 bg-slate-50 rounded-xl">
      <div class="flex flex-col gap-2">
         <label class="text-sm font-bold text-slate-700">السماح بترحيل الرصيد؟</label>
         <p-toggleSwitch formControlName="allowCarryForward"></p-toggleSwitch>
      </div>
      <div class="flex-1 space-y-1.5" *ngIf="typeForm.get('allowCarryForward')?.value">
        <label class="block text-sm font-bold text-slate-700">أقصى عدد أيام للترحيل</label>
        <p-inputNumber formControlName="maxCarryForwardDays" class="w-full" [min]="0"></p-inputNumber>
      </div>
    </div>

    <div class="flex justify-end gap-2 pt-4 border-t">
      <p-button label="إلغاء" [text]="true" severity="secondary" (click)="showModal = false"></p-button>
      <p-button label="حفظ البيانات" type="submit" styleClass="rounded-xl px-8" [loading]="saving()" [disabled]="typeForm.invalid"></p-button>
    </div>
  </form>
</p-dialog>
