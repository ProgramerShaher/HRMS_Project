<div class="p-4 bg-white dark:bg-zinc-900">
  <form [formGroup]="leaveForm" (ngSubmit)="submit()" class="space-y-4">
    
    <!-- Employee Selection (Only for Admin/Manager) -->
    @if (isAdmin()) {
      <div class="space-y-1.5">
        <label class="block text-sm font-bold text-slate-700 dark:text-zinc-300">الموظف *</label>
        <p-select 
          formControlName="employeeId"
          [options]="employees()"
          optionLabel="fullNameAr"
          optionValue="employeeId"
          placeholder="اختر الموظف"
          [filter]="true"
          filterBy="fullNameAr,employeeNumber"
          styleClass="w-full rounded-xl"
          [class.ng-invalid]="leaveForm.get('employeeId')?.invalid && leaveForm.get('employeeId')?.touched">
          <ng-template pTemplate="selectedItem" let-selectedOption>
            <div class="flex items-center gap-2">
              <span class="font-bold text-blue-600">#{{ selectedOption?.employeeNumber }}</span>
              <span>{{ selectedOption?.fullNameAr }}</span>
            </div>
          </ng-template>
          <ng-template pTemplate="item" let-employee>
            <div class="flex flex-col">
              <span class="font-bold text-slate-800">{{ employee.fullNameAr }}</span>
              <span class="text-xs text-slate-500">رقم الموظف: {{ employee.employeeNumber }}</span>
            </div>
          </ng-template>
        </p-select>
      </div>
    }

    <!-- Leave Type & Balance -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="space-y-1.5">
        <label class="block text-sm font-bold text-slate-700 dark:text-zinc-300">نوع الإجازة *</label>
        <p-select 
          formControlName="leaveTypeId"
          [options]="leaveTypes()"
          optionLabel="leaveNameAr"
          optionValue="leaveTypeId"
          placeholder="اختر نوع الإجازة"
          styleClass="w-full rounded-xl"
          [class.ng-invalid]="leaveForm.get('leaveTypeId')?.invalid && leaveForm.get('leaveTypeId')?.touched">
        </p-select>
      </div>
      
      <div class="space-y-1.5">
        <label class="block text-sm font-bold text-slate-700 dark:text-zinc-300">الرصيد المتاح</label>
        <div class="flex items-center h-[42px] px-4 bg-blue-50/50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800/50 rounded-xl">
          <span class="text-xl font-extrabold text-blue-600 dark:text-blue-400">{{ selectedBalance() ?? '-' }}</span>
          <span class="text-xs text-blue-500/70 mr-2 font-bold">يوم متاح</span>
        </div>
      </div>
    </div>

    <!-- Date Range -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="space-y-1.5">
        <label class="block text-sm font-bold text-slate-700 dark:text-zinc-300">من تاريخ *</label>
        <p-datepicker 
          formControlName="startDate"
          [showIcon]="true"
          dateFormat="yy-mm-dd"
          placeholder="اختر التاريخ"
          styleClass="w-full rounded-xl"
          [class.ng-invalid]="leaveForm.get('startDate')?.invalid && leaveForm.get('startDate')?.touched">
        </p-datepicker>
      </div>
      
      <div class="space-y-1.5">
        <label class="block text-sm font-bold text-slate-700 dark:text-zinc-300">إلى تاريخ *</label>
        <p-datepicker 
          formControlName="endDate"
          [showIcon]="true"
          dateFormat="yy-mm-dd"
          placeholder="اختر التاريخ"
          styleClass="w-full rounded-xl"
          [class.ng-invalid]="leaveForm.get('endDate')?.invalid && leaveForm.get('endDate')?.touched">
        </p-datepicker>
      </div>
    </div>

    <!-- Calculated Days & Summary -->
    <div class="bg-slate-50 dark:bg-zinc-800/50 border border-slate-100 dark:border-zinc-800 rounded-xl p-4 flex items-center justify-between">
      <div class="flex items-center gap-3 text-slate-600 dark:text-zinc-400">
        <i class="pi pi-info-circle text-blue-500"></i>
        <span class="text-sm font-medium">إجمالي الأيام المطلوبة:</span>
      </div>
      <span class="text-2xl font-black text-slate-900 dark:text-white">{{ calculatedDays() }} <span class="text-xs font-normal text-slate-400">أيـام</span></span>
    </div>

    <!-- Reason -->
    <div class="space-y-1.5">
      <label class="block text-sm font-bold text-slate-700 dark:text-zinc-300">سبب طلب الإجازة *</label>
      <textarea 
        pTextarea
        formControlName="reason"
        rows="3"
        placeholder="يرجى كتابة سبب الطلب بالتفصيل هنا..."
        class="w-full text-sm rounded-xl border-slate-200 dark:border-zinc-800 focus:ring-blue-500 transition-all"
        [class.border-red-500]="leaveForm.get('reason')?.invalid && leaveForm.get('reason')?.touched">
      </textarea>
      <div class="flex justify-between items-center px-1">
        <small class="text-[10px] text-slate-400 font-medium tracking-wide">الحد الأدنى 10 أحرف</small>
        @if (leaveForm.get('reason')?.value?.length > 0) {
          <small class="text-[10px] text-slate-400 font-medium">{{ leaveForm.get('reason')?.value?.length }} حرف</small>
        }
      </div>
    </div>

    <!-- Actions -->
    <div class="flex gap-3 justify-end pt-4 border-t border-slate-50 dark:border-zinc-800">
      <p-button 
        label="إلغاء النافذة" 
        severity="secondary" 
        [outlined]="true"
        styleClass="rounded-xl px-4"
        type="button"
        (onClick)="cancel()">
      </p-button>
      <p-button 
        label="تأكيد وتقديم الطلب" 
        icon="pi pi-paper-plane"
        styleClass="p-button-primary rounded-xl px-6"
        type="submit"
        [loading]="loading()"
        [disabled]="leaveForm.invalid">
      </p-button>
    </div>
  </form>
</div>
