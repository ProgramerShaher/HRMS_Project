<div class="p-6 space-y-8 animate-slide-up">
  
  <!-- Premium Header & Stats -->
  <div class="flex flex-col xl:flex-row gap-6">
    <!-- Main Title Card -->
    <div class="flex-grow premium-header p-8 rounded-[2rem] flex items-center justify-between overflow-hidden relative">
      <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-blue-500/5 rounded-full blur-3xl"></div>
      <div class="relative z-10 flex items-center gap-6">
        <div class="w-16 h-16 luxury-gradient-blue rounded-2xl flex items-center justify-center shadow-lg shadow-blue-500/30">
          <i class="pi pi-list text-3xl text-white"></i>
        </div>
        <div>
          <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight">عناصر الراتب</h1>
          <p class="text-slate-500 dark:text-zinc-400 font-medium mt-1">تكوين وإدارة البدلات والخصومات للنظام</p>
        </div>
      </div>
      
      <div class="relative z-10 hidden md:flex gap-3">
        <button pButton icon="pi pi-refresh" (click)="loadElements()" [loading]="loading()" class="p-button-rounded p-button-text p-button-secondary glass-card w-12 h-12"></button>
        <button pButton label="عنصر جديد" icon="pi pi-plus" (click)="createNew()" class="p-button-raised luxury-gradient-blue rounded-2xl px-8 border-none shadow-xl h-12 font-bold"></button>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="flex flex-col sm:flex-row gap-4">
      <div class="glass-card p-6 rounded-[2rem] min-w-[180px] flex flex-col justify-center">
        <div class="flex items-center gap-3 mb-2">
          <div class="w-8 h-8 luxury-gradient-emerald rounded-lg flex items-center justify-center text-white">
            <i class="pi pi-plus-circle text-xs"></i>
          </div>
          <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">إجمالي البدلات</p>
        </div>
        <h3 class="text-3xl font-black text-emerald-600 dark:text-emerald-400">{{ getAllowancesCount() }}</h3>
      </div>
      
      <div class="glass-card p-6 rounded-[2rem] min-w-[180px] flex flex-col justify-center">
        <div class="flex items-center gap-3 mb-2">
          <div class="w-8 h-8 luxury-gradient-amber rounded-lg flex items-center justify-center text-white">
            <i class="pi pi-minus-circle text-xs"></i>
          </div>
          <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">إجمالي الخصومات</p>
        </div>
        <h3 class="text-3xl font-black text-amber-600 dark:text-amber-400">{{ getDeductionsCount() }}</h3>
      </div>
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="glass-card p-8 rounded-[2rem] border-none shadow-sm animate-slide-up" style="animation-delay: 100ms">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Search Input -->
      <div class="space-y-2">
        <label class="text-xs font-black text-slate-400 uppercase tracking-[0.1em] px-1">البحث عن عنصر</label>
        <div class="relative flex items-center">
          <i class="pi pi-search absolute right-4 text-slate-400"></i>
          <input type="text" pInputText placeholder="اسم العنصر بالعربي أو الإنجليزي..." [(ngModel)]="searchTerm" (input)="applyFilters()" class="w-full pr-12 h-12 bg-slate-50 dark:bg-slate-800/30 border-slate-200 dark:border-slate-800 rounded-xl" />
        </div>
      </div>

      <!-- Type Select -->
      <div class="space-y-2">
        <label class="text-xs font-black text-slate-400 uppercase tracking-[0.1em] px-1">نوع العنصر</label>
        <p-select [options]="typeOptions" [(ngModel)]="selectedType" optionLabel="label" placeholder="جميع الأنواع" (onChange)="applyFilters()" styleClass="w-full h-12 rounded-xl bg-slate-50 dark:bg-slate-800/30 border-slate-200 dark:border-slate-800"></p-select>
      </div>

      <!-- Status Select -->
      <div class="space-y-2">
        <label class="text-xs font-black text-slate-400 uppercase tracking-[0.1em] px-1">الحالة التشغيلية</label>
        <p-select [options]="statusOptions" [(ngModel)]="selectedStatus" optionLabel="label" placeholder="جميع الحالات" (onChange)="applyFilters()" styleClass="w-full h-12 rounded-xl bg-slate-50 dark:bg-slate-800/30 border-slate-200 dark:border-slate-800"></p-select>
      </div>

      <!-- Reset -->
      <div class="flex items-end">
        <button pButton label="تصفير الفلاتر" icon="pi pi-filter-slash" (click)="clearFilters()" class="p-button-text p-button-secondary w-full h-12 rounded-xl font-bold"></button>
      </div>
    </div>
  </div>

  <!-- Elements Table -->
  <div class="glass-card rounded-[2rem] overflow-hidden border-none shadow-xl animate-slide-up" style="animation-delay: 200ms">
    <p-table
      [value]="filteredElements()"
      [loading]="loading()"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="عرض {first} - {last} من أصل {totalRecords}"
      styleClass="p-datatable-lg"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="displayOrder" class="w-20 text-center"># <p-sortIcon field="displayOrder"></p-sortIcon></th>
          <th pSortableColumn="elementNameAr">الاسم العربي <p-sortIcon field="elementNameAr"></p-sortIcon></th>
          <th>الاسم الإنجليزي</th>
          <th class="text-center">التصنيف</th>
          <th class="text-center">آلية الحساب</th>
          <th class="text-center">القيمة الافتراضية</th>
          <th class="text-center">الحالة</th>
          <th class="text-center">الإجراءات</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-element>
        <tr class="group transition-all duration-300">
          <td class="text-center">
            <span class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center mx-auto text-xs font-black text-slate-500">
              {{ element.displayOrder }}
            </span>
          </td>
          <td>
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 rounded-xl flex items-center justify-center shadow-sm transition-transform group-hover:scale-110"
                   [ngClass]="element.elementType === 'ALLOWANCE' ? 'bg-emerald-100 text-emerald-600' : 'bg-amber-100 text-amber-600'">
                <i class="pi" [ngClass]="getTypeIcon(element.elementType)"></i>
              </div>
              <span class="font-bold text-slate-700 dark:text-zinc-200">{{ element.elementNameAr }}</span>
            </div>
          </td>
          <td>
            <span class="text-sm font-medium text-slate-400 uppercase tracking-tight">{{ element.elementNameEn }}</span>
          </td>
          <td class="text-center">
            <span class="px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border"
                  [ngClass]="element.elementType === 'ALLOWANCE' ? 'bg-emerald-500/10 text-emerald-600 border-emerald-200' : 'bg-amber-500/10 text-amber-600 border-amber-200'">
              {{ getTypeLabel(element.elementType) }}
            </span>
          </td>
          <td class="text-center">
             <div class="flex flex-col">
                <span class="text-xs font-bold text-slate-600 dark:text-zinc-400">{{ getCalculationTypeLabel(element.calculationType) }}</span>
                @if (element.isTaxable) {
                    <span class="text-[9px] text-blue-500 font-bold uppercase mt-0.5"><i class="pi pi-verified text-[9px]"></i> خاضع للضريبة</span>
                }
             </div>
          </td>
          <td class="text-center">
            <span class="text-lg font-black" [ngClass]="element.elementType === 'ALLOWANCE' ? 'text-emerald-600' : 'text-rose-600'">
              {{ formatValue(element.defaultValue, element.calculationType) }}
              <small class="text-[10px] opacity-60">{{ element.calculationType === 'PERCENTAGE' ? '' : 'ر.ي' }}</small>
            </span>
          </td>
          <td class="text-center">
            <div class="flex items-center justify-center gap-2">
                <div class="w-2 h-2 rounded-full shadow-[0_0_8px]" [ngClass]="element.isActive ? 'bg-emerald-500 shadow-emerald-500' : 'bg-slate-300 shadow-transparent'"></div>
                <span class="text-xs font-black" [ngClass]="element.isActive ? 'text-emerald-600' : 'text-slate-400'">{{ element.isActive ? 'نشط' : 'معطل' }}</span>
            </div>
          </td>
          <td class="text-center">
            <div class="flex items-center justify-center gap-1">
              <button pButton icon="pi pi-pencil" (click)="editElement(element)" class="p-button-rounded p-button-text p-button-info w-10 h-10 hover:bg-info-50 transition-colors" pTooltip="تعديل التفاصيل"></button>
              <button pButton [icon]="element.isActive ? 'pi pi-power-off' : 'pi pi-play'" (click)="toggleStatus(element)" class="p-button-rounded p-button-text w-10 h-10 transition-colors" [ngClass]="element.isActive ? 'p-button-danger hover:bg-rose-50' : 'p-button-success hover:bg-emerald-50'" [pTooltip]="element.isActive ? 'إيقاف التشغيل' : 'تفعيل التشغيل'"></button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="text-center py-20 bg-slate-50/50 dark:bg-slate-900/10">
            <div class="flex flex-col items-center gap-4">
              <div class="w-24 h-24 bg-slate-200 dark:bg-slate-800 rounded-full flex items-center justify-center opacity-30">
                <i class="pi pi-search text-5xl"></i>
              </div>
              <div>
                <p class="text-xl font-black text-slate-400 dark:text-zinc-600">لا توجد نتائج مطابقة</p>
                <p class="text-sm text-slate-400 mt-1">جرب تغيير معايير البحث أو الفلترة</p>
              </div>
              <button pButton label="إعادة ضبط" icon="pi pi-filter-slash" (click)="clearFilters()" class="p-button-text p-button-secondary mt-2"></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
