<div class="structures-container p-4 md:p-8 space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
  
  <!-- Premium Header & Stats Section -->
  <div class="flex flex-col lg:flex-row lg:items-end justify-between gap-8 no-print">
    <div class="space-y-2">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400 text-xs font-bold uppercase tracking-wider">
        <i class="pi pi-briefcase"></i> إدارة الأجور
      </div>
      <h1 class="text-4xl font-black text-slate-900 dark:text-white tracking-tight">هياكل رواتب الموظفين</h1>
      <p class="text-lg text-slate-500 dark:text-zinc-400 max-w-2xl">مراقبة وتعديل مكونات الراتب لكافة الكوادر الوظيفية</p>
    </div>

    <!-- Quick Stats Overlays -->
    <div class="flex items-center gap-6">
      <div class="flex flex-col items-end">
        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">إجمالي الموظفين</span>
        <span class="text-3xl font-black text-slate-900 dark:text-white">{{ structures().length }}</span>
      </div>
      <div class="h-12 w-px bg-slate-200 dark:bg-zinc-800"></div>
      <div class="flex flex-col items-end">
        <span class="text-[10px] font-black text-amber-500 uppercase tracking-widest">بانتظار الهيكلة</span>
        <span class="text-3xl font-black text-amber-500">{{ getPendingCount() }}</span>
      </div>
    </div>
  </div>

  <!-- Interactive Filter Toolbar -->
  <div class="glass-panel p-4 rounded-3xl flex flex-wrap items-center gap-4 shadow-xl border-white/40 no-print">
    <div class="relative flex-1 min-w-[300px]">
      <i class="pi pi-search absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="applyFilters()"
        placeholder="بحث باسم الموظف، الكود، أو القسم..." 
        class="w-full pr-12 pl-4 py-3 bg-slate-50 dark:bg-zinc-800/50 border-none rounded-2xl text-sm font-bold focus:ring-2 focus:ring-indigo-500 outline-none transition-all"
      >
    </div>
    
    <div class="flex items-center gap-2">
      <p-button icon="pi pi-filter-slash" [rounded]="true" [text]="true" (onClick)="clearFilters()"></p-button>
      <div class="h-8 w-px bg-slate-200 dark:bg-zinc-800"></div>
      <p-button icon="pi pi-refresh" [rounded]="true" [text]="true" (onClick)="loadStructures()" [loading]="loading()"></p-button>
    </div>
  </div>

  <!-- Main Content Area -->
  @if (loading()) {
    <div class="flex flex-col items-center justify-center py-32 space-y-4">
      <div class="relative w-16 h-16">
        <div class="absolute inset-0 border-4 border-indigo-500/10 rounded-full"></div>
        <div class="absolute inset-0 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
      </div>
      <p class="text-slate-500 font-medium animate-pulse">جاري جلب بيانات الرواتب...</p>
    </div>
  } @else {
    <div class="glass-panel rounded-[40px] shadow-2xl overflow-hidden border-none backdrop-blur-3xl bg-white/90 dark:bg-zinc-900/90">
      <p-table 
        [value]="filteredStructures()" 
        [paginator]="true" 
        [rows]="10"
        [responsiveLayout]="'scroll'"
        styleClass="p-datatable-lg p-datatable-gridlines no-border"
      >
        <ng-template pTemplate="header">
          <tr class="bg-slate-50/50 dark:bg-zinc-800/50">
            <th class="!bg-transparent text-slate-900 dark:text-white font-black">الموظف</th>
            <th class="!bg-transparent text-slate-900 dark:text-white font-black">القسم والوظيفة</th>
            <th class="!bg-transparent text-left font-black">الراتب الأساسي</th>
            <th class="!bg-transparent text-left font-black">الإجمالي (Net)</th>
            <th class="!bg-transparent text-center font-black">الحالة</th>
            <th class="!bg-transparent text-center font-black w-32">الإجراءات</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-s>
          <tr class="hover:bg-indigo-50/20 dark:hover:bg-indigo-900/10 transition-all duration-300 group">
            <td>
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-lg font-black shadow-lg shadow-indigo-500/20">
                  {{ s.employeeNameAr?.charAt(0) }}
                </div>
                <div>
                  <h4 class="font-black text-slate-900 dark:text-white">{{ s.employeeNameAr }}</h4>
                  <p class="text-[10px] font-bold text-slate-400 tracking-widest uppercase">CODE: {{ s.employeeCode }}</p>
                </div>
              </div>
            </td>
            <td>
              <div class="space-y-1">
                <div class="flex items-center gap-2 text-xs font-bold text-slate-600 dark:text-zinc-400">
                  <i class="pi pi-building text-[10px]"></i>
                  <span>{{ s.departmentName || 'غير محدد' }}</span>
                </div>
                <div class="flex items-center gap-2 text-[10px] font-bold text-slate-400 uppercase">
                  <i class="pi pi-user text-[10px]"></i>
                  <span>{{ s.jobTitle || 'بدون مسمى' }}</span>
                </div>
              </div>
            </td>
            <td class="text-left font-black text-slate-900 dark:text-white">
              {{ formatCurrency(s.basicSalary) }}
            </td>
            <td class="text-left">
              <span class="text-xl font-black text-indigo-600">{{ formatCurrency(s.netSalary) }}</span>
              <div class="flex items-center gap-2 mt-1">
                <span class="text-[9px] font-black py-0.5 px-2 rounded bg-emerald-50 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400">+{{ s.allowancesCount }} بدل</span>
                <span class="text-[9px] font-black py-0.5 px-2 rounded bg-rose-50 text-rose-600 dark:bg-rose-900/30 dark:text-rose-400">-{{ s.deductionsCount }} خصم</span>
              </div>
            </td>
            <td class="text-center">
              <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full" 
                   [ngClass]="s.hasStructure ? 'bg-emerald-50 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400' : 'bg-amber-50 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400'">
                <span class="w-1.5 h-1.5 rounded-full" [ngClass]="s.hasStructure ? 'bg-emerald-500' : 'bg-amber-500'"></span>
                <span class="text-[10px] font-black uppercase tracking-wider">{{ s.hasStructure ? 'مكتملة' : 'قيد الهيكلة' }}</span>
              </div>
            </td>
            <td class="text-center">
              <p-button 
                icon="pi pi-external-link" 
                [rounded]="true" 
                [text]="true" 
                (onClick)="editStructure(s)"
                class="opacity-0 group-hover:opacity-100 transition-opacity"
              ></p-button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center py-20">
              <div class="flex flex-col items-center gap-4">
                <div class="w-20 h-20 bg-slate-50 dark:bg-zinc-800 rounded-full flex items-center justify-center">
                  <i class="pi pi-users text-3xl text-slate-300"></i>
                </div>
                <div class="space-y-1">
                  <h4 class="text-xl font-black text-slate-900 dark:text-white">لا توجد بيانات موظفين</h4>
                  <p class="text-sm text-slate-500">لم نتمكن من العثور على أي نتائج تطابق بحثك</p>
                </div>
                <p-button label="إعادة الضبط" icon="pi pi-refresh" [rounded]="true" [outlined]="true" (onClick)="clearFilters()"></p-button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  }
</div>
