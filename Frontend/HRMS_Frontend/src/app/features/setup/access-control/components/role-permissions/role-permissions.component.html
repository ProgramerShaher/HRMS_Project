<div class="flex flex-col h-full">
    <div class="flex-1 overflow-y-auto p-2">
        <p-tabs [value]="groups()[0]?.name">
            <p-tablist class="mb-4">
                <p-tab *ngFor="let group of groups()" [value]="group.name" class="flex items-center gap-2">
                    <span>{{ group.name }}</span>
                    <p-badge [value]="group.selectedCount.toString()" severity="info"></p-badge>
                </p-tab>
            </p-tablist>

            <p-tabpanels>
                <p-tabpanel *ngFor="let group of groups()" [value]="group.name">
                    <div
                        class="mb-4 p-3 bg-slate-50 dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700 flex justify-between items-center">
                        <span class="font-bold">تحديد الكل في {{ group.name }}</span>
                        <p-checkbox [binary]="true" [ngModel]="isGroupSelected(group)"
                            (onChange)="toggleGroup(group, $event.checked!)"></p-checkbox>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div *ngFor="let perm of group.permissions"
                            class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                            <p-checkbox [binary]="true" [inputId]="perm.id.toString()" [ngModel]="isSelected(perm.id)"
                                (onChange)="togglePermission(perm.id, $event.checked!)"></p-checkbox>
                            <label [for]="perm.id" class="cursor-pointer select-none flex-1">
                                <div class="font-medium text-xs">{{ perm.name }}</div>
                                <div class="text-[10px] text-slate-500">{{ perm.description || perm.name }}</div>
                            </label>
                        </div>
                    </div>
                </p-tabpanel>
            </p-tabpanels>
        </p-tabs>
    </div>

    <div class="flex justify-end gap-2 mt-4 pt-4 border-t border-slate-200 dark:border-slate-700">
        <button pButton label="إلغاء" class="p-button-text" icon="pi pi-times" (click)="onClose.emit()"></button>
        <button pButton label="حفظ التغييرات" class="p-button-primary" icon="pi pi-save" (click)="save()"></button>
    </div>
</div>