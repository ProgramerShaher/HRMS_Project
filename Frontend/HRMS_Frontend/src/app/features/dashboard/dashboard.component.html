<div class="min-h-screen bg-slate-50/50 dark:bg-slate-950/50 p-3 lg:p-4 animate-in fade-in duration-700" *ngIf="dashboardData">
    
    <!-- ERP-Scale Ultra-Compact Hero Header -->
    <header class="mb-3 relative overflow-hidden rounded-[0.75rem] bg-indigo-950 dark:bg-slate-900 p-3 lg:p-4 text-white shadow-md group">
        <div class="absolute top-0 right-0 -mr-10 -mt-10 w-24 h-24 bg-blue-500/10 rounded-full blur-xl transition-transform duration-1000 group-hover:scale-125"></div>
        <div class="absolute bottom-0 left-0 -ml-10 -mb-10 w-20 h-20 bg-emerald-500/5 rounded-full blur-xl"></div>
        
        <div class="relative z-10 flex flex-col lg:flex-row lg:items-center justify-between gap-3">
            <div class="space-y-0.5">
                <div class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-blue-500/20 border border-blue-400/30 text-blue-200 text-[7px] font-bold tracking-wider uppercase">
                    <span class="relative flex h-1 w-1">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-1 w-1 bg-emerald-500"></span>
                    </span>
                    مركز القيادة الرقمي
                </div>
                <h1 class="text-lg lg:text-xl font-black tracking-tight leading-tight">
                    أهلاً، <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-emerald-300">القائد الرقمي</span>
                </h1>
                <p class="text-slate-400 text-[10px] font-medium opacity-70">
                    ملخص شامل لكافة موديولات النظام في واجهة واحدة.
                </p>
            </div>

            <!-- ERP-Scale Quick Stats -->
            <div class="grid grid-cols-3 gap-2 lg:min-w-[280px]">
                <div [routerLink]="['/employees']" class="p-2 rounded-lg bg-white/5 border border-white/10 backdrop-blur-xl transition-all hover:bg-white/10 cursor-pointer text-center group/stat">
                    <span class="block text-slate-400 text-[7px] font-bold mb-0.5 uppercase tracking-widest group-hover/stat:text-blue-300 transition-colors">إجمالي الموظفين</span>
                    <span class="text-base font-black">{{ dashboardData.personnelMetrics.totalEmployees }}</span>
                </div>
                <div [routerLink]="['/attendance/reports']" class="p-2 rounded-lg bg-emerald-500/10 border border-emerald-400/20 backdrop-blur-xl transition-all hover:bg-emerald-500/20 cursor-pointer text-center group/stat">
                    <span class="block text-emerald-400 text-[7px] font-bold mb-0.5 uppercase tracking-widest group-hover/stat:text-emerald-300 transition-colors">الحضور اليوم</span>
                    <span class="text-base font-black text-emerald-400">{{ dashboardData.attendanceMetrics.totalPresent }}</span>
                </div>
                <div [routerLink]="['/attendance/reports']" class="p-2 rounded-lg bg-amber-500/10 border border-amber-400/20 backdrop-blur-xl transition-all hover:bg-amber-500/20 cursor-pointer text-center group/stat">
                    <span class="block text-amber-400 text-[7px] font-bold mb-0.5 uppercase tracking-widest group-hover/stat:text-amber-300 transition-colors">متأخرات اليوم</span>
                    <span class="text-base font-black text-amber-400">{{ dashboardData.attendanceMetrics.totalLate }}</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard Interactive Grid -->
    <div class="grid grid-cols-12 gap-3">
        
        <!-- Row 1: Operations & Alerts -->
        <div class="col-span-12 lg:col-span-8 flex flex-col gap-3">
            
            <!-- Statistics & Performance Center -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                
                <!-- Attendance Card (Operational) -->
                <div [routerLink]="['/attendance/reports']" class="bg-white dark:bg-slate-900 rounded-xl p-3 border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-all cursor-pointer group">
                    <div class="flex items-center justify-between mb-2">
                        <div class="p-1.5 rounded-lg bg-blue-500/10 text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform">
                            <i class="pi pi-calendar-plus text-sm"></i>
                        </div>
                        <span class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">حالة الحضور</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <div>
                            <span class="block text-[10px] text-slate-400">حاضر</span>
                            <span class="text-lg font-black text-slate-800 dark:text-slate-100">{{ dashboardData.attendanceMetrics.totalPresent }}</span>
                        </div>
                        <div>
                            <span class="block text-[10px] text-slate-400">غائب</span>
                            <span class="text-lg font-black text-rose-500">{{ dashboardData.attendanceMetrics.totalAbsent }}</span>
                        </div>
                    </div>
                </div>

                <!-- Performance Card (New) -->
                <div [routerLink]="['/performance']" class="bg-white dark:bg-slate-900 rounded-xl p-3 border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-all cursor-pointer group">
                    <div class="flex items-center justify-between mb-2">
                        <div class="p-1.5 rounded-lg bg-purple-500/10 text-purple-600 dark:text-purple-400 group-hover:scale-110 transition-transform">
                            <i class="pi pi-chart-line text-sm"></i>
                        </div>
                        <span class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">تقييم الأداء</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <div>
                            <span class="block text-[10px] text-slate-400">دورات نشطة</span>
                            <span class="text-lg font-black text-slate-800 dark:text-slate-100">{{ dashboardData.performanceMetrics.activeAppraisalCycles }}</span>
                        </div>
                        <div>
                            <span class="block text-[10px] text-slate-400">متوسط التقييم</span>
                            <span class="text-lg font-black text-purple-500">{{ dashboardData.performanceMetrics.averageCompanyRating }} ★</span>
                        </div>
                    </div>
                </div>

                <!-- System Health (Setup) -->
                <div [routerLink]="['/setup']" class="bg-white dark:bg-slate-900 rounded-xl p-3 border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-all cursor-pointer group">
                    <div class="flex items-center justify-between mb-2">
                        <div class="p-1.5 rounded-lg bg-cyan-500/10 text-cyan-600 dark:text-cyan-400 group-hover:scale-110 transition-transform">
                            <i class="pi pi-cog text-sm"></i>
                        </div>
                        <span class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">إعدادات النظام</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <div>
                            <span class="block text-[10px] text-slate-400">الإدارات</span>
                            <span class="text-lg font-black text-slate-800 dark:text-slate-100">{{ dashboardData.setupMetrics.totalDepartments }}</span>
                        </div>
                        <div>
                            <span class="block text-[10px] text-slate-400">المستخدمين</span>
                            <span class="text-lg font-black text-cyan-500">{{ dashboardData.setupMetrics.totalActiveUsers }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Operational Charts -->
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden flex-1 flex flex-col min-h-[300px]">
                <div class="p-3 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between bg-slate-50/50 dark:bg-slate-800/20">
                    <div class="flex items-center gap-2">
                        <div class="w-1 h-4 bg-indigo-500 rounded-full"></div>
                        <h3 class="text-xs font-black text-slate-800 dark:text-slate-100">تحليل الانضباط الأسبوعي</h3>
                    </div>
                    <button class="text-[9px] font-bold text-indigo-600 dark:text-indigo-400 hover:underline uppercase tracking-widest">توسيع التقرير</button>
                </div>
                <div class="p-3 flex-1 relative">
                    <p-chart type="line" [data]="weeklyTrendData" [options]="weeklyTrendOptions" height="100%"></p-chart>
                </div>
            </div>
        </div>

        <!-- Sidebar Section: Requests & Finances -->
        <div class="col-span-12 lg:col-span-4 flex flex-col gap-3">
            
            <!-- Pending Requests Terminal -->
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden h-fit">
                <div class="p-3 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/20 flex items-center justify-between">
                    <h3 class="text-xs font-black text-slate-800 dark:text-slate-100">طلبات معلقة مجمعة</h3>
                    <span class="px-2 py-0.5 rounded-full bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 text-[8px] font-bold">
                        {{ dashboardData.requestsMetrics.pendingLeaveRequests + dashboardData.requestsMetrics.pendingOvertimeRequests + dashboardData.requestsMetrics.pendingLoanRequests }} إجمالي
                    </span>
                </div>
                <div class="p-1">
                    <!-- Leave Requests -->
                    <div [routerLink]="['/leaves/approvals']" class="p-2 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-pointer rounded-lg m-1 group">
                        <div class="flex items-center gap-2">
                            <div class="p-2 h-7 w-7 flex items-center justify-center rounded-lg bg-emerald-500/10 text-emerald-600 group-hover:scale-110 transition-transform">
                                <i class="pi pi-send text-[10px]"></i>
                            </div>
                            <span class="text-[11px] font-bold text-slate-700 dark:text-slate-300">طلبات الإجازة</span>
                        </div>
                        <span class="px-2 py-0.5 rounded-md bg-slate-100 dark:bg-slate-800 text-slate-600 text-[10px] font-black group-hover:bg-emerald-500 group-hover:text-white transition-all">
                            {{ dashboardData.requestsMetrics.pendingLeaveRequests }}
                        </span>
                    </div>
                    <!-- Overtime Requests -->
                    <div [routerLink]="['/attendance/requests']" class="p-2 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-pointer rounded-lg m-1 group">
                        <div class="flex items-center gap-2">
                            <div class="p-2 h-7 w-7 flex items-center justify-center rounded-lg bg-orange-500/10 text-orange-600 group-hover:scale-110 transition-transform">
                                <i class="pi pi-clock text-[10px]"></i>
                            </div>
                            <span class="text-[11px] font-bold text-slate-700 dark:text-slate-300">ساعات إضافية</span>
                        </div>
                        <span class="px-2 py-0.5 rounded-md bg-slate-100 dark:bg-slate-800 text-slate-600 text-[10px] font-black group-hover:bg-orange-500 group-hover:text-white transition-all">
                            {{ dashboardData.requestsMetrics.pendingOvertimeRequests }}
                        </span>
                    </div>
                    <!-- Loan Requests -->
                    <div [routerLink]="['/payroll/loans/admin/pending']" class="p-2 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-pointer rounded-lg m-1 group">
                        <div class="flex items-center gap-2">
                            <div class="p-2 h-7 w-7 flex items-center justify-center rounded-lg bg-blue-500/10 text-blue-600 group-hover:scale-110 transition-transform">
                                <i class="pi pi-dollar text-[10px]"></i>
                            </div>
                            <span class="text-[11px] font-bold text-slate-700 dark:text-slate-300">سلف مالية</span>
                        </div>
                        <span class="px-2 py-0.5 rounded-md bg-slate-100 dark:bg-slate-800 text-slate-600 text-[10px] font-black group-hover:bg-blue-500 group-hover:text-white transition-all">
                            {{ dashboardData.requestsMetrics.pendingLoanRequests }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Financial Pulse -->
            <div [routerLink]="['/payroll/dashboard']" class="bg-indigo-600 rounded-xl p-4 text-white shadow-lg overflow-hidden relative cursor-pointer group">
                <div class="absolute top-0 right-0 -mr-6 -mt-6 w-24 h-24 bg-white/10 rounded-full blur-xl transition-all group-hover:scale-150"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-3">
                        <i class="pi pi-wallet text-sm opacity-80"></i>
                        <span class="text-[9px] font-bold uppercase tracking-widest opacity-80">النبض المالي (الشهر الحالي)</span>
                    </div>
                    <div class="space-y-1">
                        <p class="text-[10px] opacity-70">إجمالي الرواتب الصافية</p>
                        <h2 class="text-2xl font-black">
                            {{ dashboardData.monthlyMetrics.totalNetSalary | number:'1.0-0' }}
                            <span class="text-xs font-normal opacity-80">ريال</span>
                        </h2>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/10 flex items-center justify-between">
                        <div class="flex items-center gap-1 group-hover:translate-x-1 transition-transform">
                            <span class="text-[10px] font-bold">عرض تفاصيل المسيرات</span>
                            <i class="pi pi-arrow-left text-[8px]"></i>
                        </div>
                        <span class="text-[8px] px-1.5 py-0.5 rounded bg-white/20 font-bold uppercase tracking-tighter">Budget Live</span>
                    </div>
                </div>
            </div>

            <!-- System Assets & Health (New Compact View) -->
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                <div class="p-3 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/20">
                    <h3 class="text-xs font-black text-slate-800 dark:text-slate-100">أصول النظام</h3>
                </div>
                <div class="grid grid-cols-2 text-center">
                    <div [routerLink]="['/setup/departments']" class="p-3 border-r border-b border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-pointer">
                        <span class="block text-[8px] font-bold text-slate-400 uppercase tracking-widest">المناوبات</span>
                        <span class="text-base font-black text-indigo-500">{{ dashboardData.setupMetrics.totalShiftTypes }}</span>
                    </div>
                    <div [routerLink]="['/setup/jobs']" class="p-3 border-b border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-pointer">
                        <span class="block text-[8px] font-bold text-slate-400 uppercase tracking-widest">الوظائف</span>
                        <span class="text-base font-black text-indigo-500">{{ dashboardData.setupMetrics.totalJobTitles }}</span>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Final High-Resolution Analytics Row -->
    <div class="grid grid-cols-12 gap-3 mt-3">
        <div class="col-span-12">
            <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden min-h-[300px]">
                <div class="p-3 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div class="p-1 px-2 rounded-lg bg-indigo-500 text-white text-[10px] font-black">SAR</div>
                        <h3 class="text-xs font-black text-slate-800 dark:text-slate-100">توزيع كتلة الأجور حسب الإدارة</h3>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="flex items-center gap-1.5">
                            <span class="w-2 h-2 rounded-full bg-indigo-500"></span>
                            <span class="text-[9px] font-bold text-slate-400 uppercase">ميزانية معتمدة</span>
                        </div>
                    </div>
                </div>
                <div class="p-3 h-[250px] relative">
                    <p-chart type="bar" [data]="payrollChartData" [options]="payrollChartOptions" height="100%"></p-chart>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Ultra-Compact Skeleton Loading -->
<div class="p-4 space-y-4" *ngIf="loading">
    <div class="h-24 bg-slate-200 dark:bg-slate-800 rounded-xl animate-pulse"></div>
    <div class="grid grid-cols-3 gap-4">
        <div class="h-24 bg-slate-200 dark:bg-slate-800 rounded-xl animate-pulse"></div>
        <div class="h-24 bg-slate-200 dark:bg-slate-800 rounded-xl animate-pulse"></div>
        <div class="h-24 bg-slate-200 dark:bg-slate-800 rounded-xl animate-pulse"></div>
    </div>
    <div class="h-64 bg-slate-200 dark:bg-slate-800 rounded-xl animate-pulse"></div>
</div>
